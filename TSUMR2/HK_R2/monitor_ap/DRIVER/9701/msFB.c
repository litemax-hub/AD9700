
#define _MS_FB_C
#include "Global.h"
#include "msEread.h"

#if (CHIP_ID==CHIP_MT9700) || (CHIP_ID==CHIP_MT9701)
#define MSFB_DEBUG    1

#if ENABLE_DEBUG && MSFB_DEBUG
#define MSFB_printData(str, value)   printData(str, value)
#define MSFB_printMsg(str)           printMsg(str)
#else
#define MSFB_printData(str, value)
#define MSFB_printMsg(str)
#endif

code BYTE tMemTestMode[] = { 0x07, 0x09, 0x05, 0x03, 0x0B };
#ifdef TSUMR2_FPGA
code RegUnitType tInitMemory[] =
{
    {0x122426,0x80},
    {0x122427,0x00},
    {0x12242a,0x31},
    {0x12242b,0x00},
    {0x1220dc,0x0e},
    {0x1220dd,0x00},
    {0x122436,0xe0},
    {0x122437,0x00},
    {0x122428,0x00},
    {0x122429,0x04},
    {0x12201e,0x00},
    {0x12201f,0x0c},
    {0x12201e,0x01},
    {0x1222e6,0xfe},
    {0x1222e7,0xff},
    {0x122002,0x00},
    {0x122003,0x08},
    {0x122004,0xc6},
    {0x122005,0x00},
    {0x122006,0x00},
    {0x122007,0x00},
    {0x122028,0x00},
    {0x122029,0x01},
    {0x122420,0x00},
    {0x122421,0x12},
    {0x122422,0x01},
    {0x122423,0x11},
    {0x122440,0x03},
    {0x122441,0x03},
    {0x122442,0x08},
    {0x122443,0x03},
    {0x122444,0x03},
    {0x122445,0x0c},
    {0x122446,0x01},
    {0x122447,0x01},
    {0x122448,0x01},
    {0x122449,0x07},
    {0x12244a,0x01},
    {0x12244b,0x01},
    {0x12244e,0x0e},
    {0x12244f,0x00},
    {0x122450,0x0e},
    {0x122451,0x00},
    {0x122454,0x09},
    {0x122455,0x0f},
    {0x12245c,0x0f},
    {0x12245d,0x00},
    {0x12245e,0xba},
    {0x12245f,0x00},
    {0x122460,0x31},
    {0x122461,0x00},
    {0x122480,0x10},
    {0x122481,0x80},
    {0x122486,0x00},
    {0x122487,0x00},
    {0x122060,0x01},
    {0x122061,0x00},
    {0x122076,0x20},
    {0x122077,0x00},
    {0x122078,0x0c},
    {0x122079,0x0c},
    {0x12207a,0x0c},
    {0x12207b,0x0c},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x122480,0xf0},
    {0x122481,0x80},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    {0x122030,0x20},
    {0x122031,0xd0},
    {0x1224de,0x02},
    {0x1224df,0x80},
    {0x12201e,0x00},
    {0x12201f,0x8c},
    {0x122000,0x00},
    {0x122001,0x00},
    {0x122000,0x08},
    {0x122000,0x0c},
    {0x122000,0x0e},
    {0x122000,0x1f},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x121dec,0x00},
    {0x121ded,0xc0},
    {0x1224c8,0x11},
    {0x1224c9,0x00},
    {0x122204,0x00},
    {0x122205,0x00},
    {0x122206,0xfe},
    {0x122207,0x7f},
    {0x12220a,0xff},
    {0x12220b,0xff},
    {0x1222fe,0x01},
    {0x1222ff,0x10},
    {0x122296,0x48},
    {0x122297,0x28},
    {0x12229a,0xb5},
    {0x12229b,0x20},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    {0x122030,0x20},
    {0x122031,0xd0},
    {0x1224a0,0xf0},
    {0x1224a1,0xf2},
    {0x1224a8,0x00},
    {0x1224a9,0x03},
    {0x1224aa,0x52},
    {0x1224ab,0xcb},
    {0x1224ac,0x07},
    {0x1224ad,0x00},
    {0x123080,0x15},
    {0x123081,0x80},
    {0x123300,0x15},
    {0x123301,0x80},
    {0x1217c6,0xff},
    {0x1217c7,0xff},
    {0x1217c8,0x07},
    {0x1217c9,0x00},
    {0x121700,0x00},
    {0x121701,0x10},
    {0x121702,0x00},
    {0x121703,0x10},
    {0x123086,0x00},
    {0x123087,0x00},
    {0x123306,0x00},
    {0x123307,0x00},
    {0x1222e6,0x00},
    {0x1222e7,0x00},
    {0x12201e,0x08},
    {0x12201f,0x0c}
};
#else
#if ((DRAM_TYPE == DDR2_1333_512Mb_QFP156) || (DRAM_TYPE == DDR2_QFP156))
code RegUnitType tInitMemory_WB_DDR2_1333_512Mb_QFP156[] = //QFP156
{
    {0x122030,0x00},
    {0x122031,0x00},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x1220d0,0x00},
    {0x1220d1,0x00},
//MIU Channel Config Setting
    {0x122426,0x80},
    {0x122427,0x00},
    {0x12242a,0x31},
    {0x12242b,0x00},
    {0x1220dc,0x0e},
    {0x1220dd,0x00},
    {0x122436,0xe0},
    {0x122437,0x00},
    {0x122428,0x00},
    {0x122429,0x00},
//MIU DDRPLL Setting  
    {0x12201e,0x00},
    {0x12201f,0x0c},
    {0x12201e,0x01},
    {0x1222e6,0xfe},
    {0x1222e7,0xff},
    {0x122178,0x02},
    {0x122179,0x01},
    {0x122136,0x00},
    {0x122137,0x00},
    {0x122134,0x02},
    {0x122135,0x01},
    {0x12218c,0x00},
    {0x12218d,0x04},
    {0x122130,0xd5},
    {0x122131,0xed},
    {0x122132,0x29},
    {0x122133,0x00},
    {0x12218a,0x01},
    {0x12218b,0x00},
    {0x122184,0x00},
    {0x122185,0x00},
    {0x122186,0x08},
    {0x122187,0x00},
    {0x12218c,0x00},
    {0x12218d,0x00},
    {0x122122,0x00},
    {0x122123,0x28},
    {0x12212c,0x14},
    {0x12212d,0x01},
//MIU table Setting (DDR2_4X_1333)    
    {0x122002,0x00},
    {0x122003,0x02},
    {0x122004,0x52},
    {0x122005,0x00},
    {0x122006,0x00},
    {0x122007,0x00},
    {0x122028,0x60},
    {0x122029,0x00},
    {0x122420,0x02},
    {0x122421,0x30},
    {0x122422,0x01},
    {0x122423,0x02},
    {0x122440,0x0a},
    {0x122441,0x0a},
    {0x122442,0x1e},
    {0x122443,0x07},
    {0x122444,0x07},
    {0x122445,0x27},
    {0x122446,0x08},
    {0x122447,0x0a},
    {0x122448,0x05},
    {0x122449,0x09},
    {0x12244a,0x04},
    {0x12244b,0x05},
    {0x12244c,0x2a},
    {0x12244d,0x05},
    {0x12244e,0x57},
    {0x12244f,0x00},
    {0x122450,0x00},
    {0x122451,0xe0},
    {0x122452,0x00},
    {0x122453,0x00},
    {0x122454,0x00},
    {0x122455,0x0a},
    {0x12245a,0x02},
    {0x12245b,0x08},
    //{0x12245c,0x0f},
    //{0x12245d,0x00},
    {0x12245e,0x4a},
    {0x12245f,0x03},
    {0x122460,0x03},
    {0x122461,0x00},
    {0x122462,0x40},
    {0x122463,0x40},
    {0x122464,0x00},
    {0x122465,0x80},
    {0x122466,0x00},
    {0x122467,0xc0},
    {0x122468,0x00},
    {0x122469,0x00},
    {0x12246a,0x00},
    {0x12246b,0x00},
    {0x12246c,0x00},
    {0x12246d,0x00},
    {0x122480,0x00},
    {0x122481,0x00},
    {0x122486,0x00},
    {0x122487,0x00},
    {0x122102,0xaa},
    {0x122103,0xaa},
    {0x122104,0x00},
    {0x122105,0x00},
    {0x12210e,0x8d},
    {0x12210f,0x00},
    {0x1221b6,0x00},
    {0x1221b7,0x00},
    {0x1221dc,0x0f},
    {0x1221dd,0x00},
    {0x1221e0,0x11},
    {0x1221e1,0x00},
    {0x1221e2,0x11},
    {0x1221e3,0x00},
    {0x1221e4,0x10},
    {0x1221e5,0x00},
    {0x1221e6,0x11},
    {0x1221e7,0x11},
    {0x1221e8,0x11},
    {0x1221e9,0x11},
    {0x1221ea,0x11},
    {0x1221eb,0x11},
    {0x1221ec,0x11},
    {0x1221ed,0x11},
    {0x1221ee,0x11},
    {0x1221ef,0x11},
    {0x1221f0,0x33},
    {0x1221f1,0x33},
    {0x1221f2,0x33},
    {0x1221f3,0x00},
    {0x121a00,0x02},
    {0x121a01,0x00},
    {0x121a04,0x00},
    {0x121a05,0x00},
    {0x121a08,0x00},
    {0x121a09,0x00},
    {0x121a0a,0x00},
    {0x121a0b,0x00},
    {0x121a0c,0x00},
    {0x121a0d,0x02},
    {0x121a10,0x00},
    {0x121a11,0x00},
    {0x121a12,0x00},
    {0x121a13,0x00},
    {0x121a14,0x07},
    {0x121a15,0x1f},
    {0x121a16,0x1f},
    {0x121a17,0x1f},
    {0x121a1e,0x00},
    {0x121a1f,0x00},
    {0x121a20,0x1f},
    {0x121a21,0x1f},
    {0x121a22,0x0a},
    {0x121a23,0x1f},
    {0x121a24,0x1f},
    {0x121a25,0x1f},
    {0x121a26,0x1f},
    {0x121a27,0x0a},
    {0x121a28,0x1f},
    {0x121a29,0x1f},
    {0x121a2a,0x1f},
    {0x121a2b,0x1f},
    {0x121a2c,0x0a},
    {0x121a2d,0x0a},
    {0x121a2e,0x1f},
    {0x121a2f,0x0a},
    {0x121a30,0x07},
    {0x121a31,0x07},
    {0x121a32,0x07},
    {0x121a33,0x07},
    {0x121a34,0x07},
    {0x121a35,0x07},
    {0x121a36,0x07},
    {0x121a37,0x07},
    {0x121a38,0x07},
    {0x121a39,0x07},
    {0x121a3a,0x07},
    {0x121a3b,0x07},
    {0x121a3c,0x07},
    {0x121a3d,0x07},
    {0x121a3e,0x07},
    {0x121a3f,0x07},
    {0x121a60,0x03},
    {0x121a61,0x03},
    {0x121a62,0x07},
    {0x121a63,0x07},
    {0x121a64,0x08},
    {0x121a65,0x08},
    {0x121a66,0x08},
    {0x121a67,0x08},
    {0x121a68,0x08},
    {0x121a69,0x08},
    {0x121a6a,0x08},
    {0x121a6b,0x08},
    {0x121a80,0x00},
    {0x121a81,0x00},
    {0x121a82,0x01},
    {0x121a83,0x00},
    {0x121a84,0x01},
    {0x121a85,0x00},
    {0x121a86,0x00},
    {0x121a87,0x01},
    {0x121a88,0x05},
    {0x121a89,0x00},
    {0x121a8a,0x03},
    {0x121a8b,0x02},
    {0x121a8c,0x02},
    {0x121a8d,0x02},
    {0x121a8e,0x01},
    {0x121a8f,0x04},
    {0x121a90,0x01},
    {0x121a91,0x01},
    {0x121a92,0x01},
    {0x121a93,0x01},
    {0x121a94,0x01},
    {0x121a95,0x01},
    {0x121a96,0x01},
    {0x121a97,0x01},
    {0x121a98,0x01},
    {0x121a99,0x01},
    {0x121a9a,0x01},
    {0x121a9b,0x01},
    {0x121a9c,0x01},
    {0x121a9d,0x01},
    {0x121a9e,0x01},
    {0x121a9f,0x01},
    {0x121ae0,0x00},
    {0x121ae1,0x00},
    {0x121ae2,0x00},
    {0x121ae3,0x00},
    {0x121ae4,0x00},
    {0x121ae5,0x00},
    {0x121ae6,0x00},
    {0x121ae7,0x00},
    {0x121ae8,0x00},
    {0x121ae9,0x00},
    {0x121aea,0x00},
    {0x121aeb,0x00},
    {0x121aec,0x00},
    {0x121aed,0x00},
    {0x121aee,0x00},
    {0x121aef,0x00},
    {0x121af0,0x00},
    {0x121af1,0x00},
    {0x121af2,0x00},
    {0x121af3,0x00},
    {0x122194,0x26},
    {0x122195,0x04},
    {0x122196,0x00},
    {0x122197,0x00},
    {0x1221a4,0x2a},
    {0x1221a5,0x20},
    {0x1221a6,0x00},
    {0x1221a7,0x00},
//MIU pre-inivec Setting    
    {0x122162,0x7f},
    {0x122163,0x00},
    {0x122164,0x00},
    {0x122165,0xf1},
    {0x122160,0xcb},
    {0x122161,0x00},
    {0x122160,0xcf},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc2},
    {0x122160,0xc0},
    {0x122160,0xc8},
    {0x122161,0x33},
    {0x122170,0x00},
    {0x122171,0x00},
    {0x122198,0x00},
    {0x122199,0x00},
    {0x12219a,0x00},
    {0x12219b,0x00},
    {0x122190,0xf3},
    {0x122191,0xf0},
    {0x122170,0x00},
    {0x122171,0x08},
    {0x121aa0,0x03},
    {0x121aa1,0x03},
    {0x121aa2,0x03},
    {0x121aa3,0x03},
    {0x121aa4,0x03},
    {0x121aa5,0x03},
    {0x121aa6,0x03},
    {0x121aa7,0x03},
    {0x121aa8,0x03},
    {0x121aa9,0x03},
    {0x121aaa,0x03},
    {0x121aab,0x03},
    {0x121aac,0x03},
    {0x121aad,0x03},
    {0x121aae,0x03},
    {0x121aaf,0x03},
    {0x121ab0,0x03},
    {0x121ab1,0x03},
    {0x121ab2,0x03},
    {0x121ab3,0x03},
    {0x12216c,0x00},
    {0x12216d,0x00},
    {0x12216e,0x04},
    {0x12216f,0x04},
    {0x122174,0x07},
    {0x122175,0x07},
    {0x122176,0x07},
    {0x122177,0x07},
    {0x12211a,0x33},
    {0x12211b,0x83},
    {0x12211c,0x20},
    {0x12211d,0x00},
    {0x122108,0x3f},
    {0x122109,0x00},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x122060,0x01},
    {0x122061,0x00},
    {0x122010,0x55},
    {0x122011,0x00},
    {0x122008,0xcc},
    {0x122009,0xcc},
    {0x12200a,0x1c},
    {0x12200b,0x00},
    {0x12200c,0x00},
    {0x12200d,0x00},
    {0x12200e,0x01},
    {0x12200f,0x00},
    {0x122076,0x20},
    {0x122077,0x00},
    {0x122078,0x0f},
    {0x122079,0x0f},
    {0x12207a,0x0f},
    {0x12207b,0x0f},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x122480,0xf0},
    {0x122481,0x80},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    //{0x1224de,0x02},
    //{0x1224df,0x80},
    {0x12201e,0x00},
    {0x12201f,0x8c},
//MIU post-inivec Setting 
    {0x12217e,0x80},
    {0x12217f,0x00},
    {0x122100,0x10},
    {0x122101,0x20},
    {0x122100,0x00},
    {0x122101,0x00},
    {0x122118,0x00},
    {0x122119,0x00},
    {0x122106,0x00},
    {0x122107,0x00},
    {0x12217c,0x05},
    {0x12217d,0x00},
    {0x122154,0x00},
    {0x122155,0xc0},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x12213e,0x00},
    {0x12213f,0x00},
//MIU DRAM init
    {0x122000,0x00},
    {0x122001,0x00},
    {0x122000,0x08},
    {0x122000,0x0c},
    {0x122000,0x0e},
    {0x122000,0x1f},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x121dec,0x00},
    {0x121ded,0xc0},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x122204,0x00},
    {0x122205,0x00},
    {0x122206,0xfe},
    {0x122207,0x7f},
    {0x12220a,0xff},
    {0x12220b,0xff},
    {0x1222fe,0x01},
    {0x1222ff,0x10},
    {0x122296,0x48},
    {0x122297,0x28},
    {0x12229a,0xb5},
    {0x12229b,0x20},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    {0x1224a0,0xf0},
    {0x1224a1,0xf2},
    {0x1224a8,0x00},
    {0x1224a9,0x03},
    {0x1224aa,0x52},
    {0x1224ab,0xcb},
    {0x1224ac,0x07},
    {0x1224ad,0x00},
    //{0x123080,0x15},
    //{0x123081,0x80},
    //{0x123300,0x15},
    //{0x123301,0x80},
    {0x1217c6,0xff},
    {0x1217c7,0xff},
    {0x1217c8,0x00},
    {0x1217c9,0x00},
    {0x121700,0x00},
    {0x121701,0x10},
    {0x121702,0x00},
    {0x121703,0x10},
    {0x123086,0x00},
    {0x123087,0x00},
    {0x123306,0x00},
    {0x123307,0x00},
    {0x1222e6,0x00},
    {0x1222e7,0x00},
    {0x12201e,0x08},
    {0x12201f,0x0c}
};
#endif
#if ((DRAM_TYPE == DDR2_1333_512Mb_QFP216) || (DRAM_TYPE == DDR2_QFP216))
code RegUnitType tInitMemory_WB_DDR2_1333_512Mb_QFP216[] = //QFP216
{
    {0x122030,0x00},
    {0x122031,0x00},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x1220d0,0x00},
    {0x1220d1,0x00},
//MIU Channel Config Setting
    {0x122426,0x80},
    {0x122427,0x00},
    {0x12242a,0x31},
    {0x12242b,0x00},
    {0x1220dc,0x0e},
    {0x1220dd,0x00},
    {0x122436,0xe0},
    {0x122437,0x00},
    {0x122428,0x00},
    {0x122429,0x00},
//MIU DDRPLL Setting  
    {0x12201e,0x00},
    {0x12201f,0x0c},
    {0x12201e,0x01},
    {0x1222e6,0xfe},
    {0x1222e7,0xff},
    {0x122178,0x02},
    {0x122179,0x01},
    {0x122136,0x00},
    {0x122137,0x00},
    {0x122134,0x02},
    {0x122135,0x01},
    {0x12218c,0x00},
    {0x12218d,0x04},
    {0x122130,0xd5},
    {0x122131,0xed},
    {0x122132,0x29},
    {0x122133,0x00},
    {0x12218a,0x01},
    {0x12218b,0x00},
    {0x122184,0x00},
    {0x122185,0x00},
    {0x122186,0x08},
    {0x122187,0x00},
    {0x12218c,0x00},
    {0x12218d,0x00},
    {0x122122,0x00},
    {0x122123,0x28},
    {0x12212c,0x14},
    {0x12212d,0x01},
//MIU table Setting (DDR2_4X_1333)    
    {0x122002,0x00},
    {0x122003,0x02},
    {0x122004,0x52},
    {0x122005,0x00},
    {0x122006,0x00},
    {0x122007,0x00},
    {0x122028,0x60},
    {0x122029,0x00},
    {0x122420,0x02},
    {0x122421,0x30},
    {0x122422,0x01},
    {0x122423,0x02},
    {0x122440,0x0a},
    {0x122441,0x0a},
    {0x122442,0x1e},
    {0x122443,0x07},
    {0x122444,0x07},
    {0x122445,0x27},
    {0x122446,0x08},
    {0x122447,0x0a},
    {0x122448,0x05},
    {0x122449,0x09},
    {0x12244a,0x04},
    {0x12244b,0x05},
    {0x12244c,0x2a},
    {0x12244d,0x05},
    {0x12244e,0x57},
    {0x12244f,0x00},
    {0x122450,0x00},
    {0x122451,0xe0},
    {0x122452,0x00},
    {0x122453,0x00},
    {0x122454,0x00},
    {0x122455,0x0a},
    {0x12245a,0x02},
    {0x12245b,0x08},
    //{0x12245c,0x0f},
    //{0x12245d,0x00},
    {0x12245e,0x4a},
    {0x12245f,0x03},
    {0x122460,0x03},
    {0x122461,0x00},
    {0x122462,0x40},
    {0x122463,0x40},
    {0x122464,0x00},
    {0x122465,0x80},
    {0x122466,0x00},
    {0x122467,0xc0},
    {0x122468,0x00},
    {0x122469,0x00},
    {0x12246a,0x00},
    {0x12246b,0x00},
    {0x12246c,0x00},
    {0x12246d,0x00},
    {0x122480,0x00},
    {0x122481,0x00},
    {0x122486,0x00},
    {0x122487,0x00},
    {0x122102,0xaa},
    {0x122103,0xaa},
    {0x122104,0x00},
    {0x122105,0x00},
    {0x12210e,0x8d},
    {0x12210f,0x00},
    {0x1221b6,0x00},
    {0x1221b7,0x00},
    {0x1221dc,0x0f},
    {0x1221dd,0x00},
    {0x1221e0,0x11},
    {0x1221e1,0x00},
    {0x1221e2,0x11},
    {0x1221e3,0x00},
    {0x1221e4,0x10},
    {0x1221e5,0x00},
    {0x1221e6,0x11},
    {0x1221e7,0x11},
    {0x1221e8,0x11},
    {0x1221e9,0x11},
    {0x1221ea,0x11},
    {0x1221eb,0x11},
    {0x1221ec,0x11},
    {0x1221ed,0x11},
    {0x1221ee,0x11},
    {0x1221ef,0x11},
    {0x1221f0,0x33},
    {0x1221f1,0x33},
    {0x1221f2,0x33},
    {0x1221f3,0x00},
    {0x121a00,0x02},
    {0x121a01,0x00},
    {0x121a04,0x00},
    {0x121a05,0x00},
    {0x121a08,0x00},
    {0x121a09,0x00},
    {0x121a0a,0x00},
    {0x121a0b,0x00},
    {0x121a0c,0x00},
    {0x121a0d,0x02},
    {0x121a10,0x00},
    {0x121a11,0x00},
    {0x121a12,0x00},
    {0x121a13,0x00},
    {0x121a14,0x07},
    {0x121a15,0x1f},
    {0x121a16,0x1f},
    {0x121a17,0x1f},
    {0x121a1e,0x00},
    {0x121a1f,0x00},
    {0x121a20,0x1f},
    {0x121a21,0x1f},
    {0x121a22,0x0a},
    {0x121a23,0x1f},
    {0x121a24,0x1f},
    {0x121a25,0x1f},
    {0x121a26,0x1f},
    {0x121a27,0x0a},
    {0x121a28,0x1f},
    {0x121a29,0x1f},
    {0x121a2a,0x1f},
    {0x121a2b,0x1f},
    {0x121a2c,0x0a},
    {0x121a2d,0x0a},
    {0x121a2e,0x1f},
    {0x121a2f,0x0a},
    {0x121a30,0x07},
    {0x121a31,0x07},
    {0x121a32,0x07},
    {0x121a33,0x07},
    {0x121a34,0x07},
    {0x121a35,0x07},
    {0x121a36,0x07},
    {0x121a37,0x07},
    {0x121a38,0x07},
    {0x121a39,0x07},
    {0x121a3a,0x07},
    {0x121a3b,0x07},
    {0x121a3c,0x07},
    {0x121a3d,0x07},
    {0x121a3e,0x07},
    {0x121a3f,0x07},
    {0x121a60,0x03},
    {0x121a61,0x03},
    {0x121a62,0x07},
    {0x121a63,0x07},
    {0x121a64,0x08},
    {0x121a65,0x08},
    {0x121a66,0x08},
    {0x121a67,0x08},
    {0x121a68,0x08},
    {0x121a69,0x08},
    {0x121a6a,0x08},
    {0x121a6b,0x08},
    {0x121a80,0x00},
    {0x121a81,0x01},
    {0x121a82,0x01},
    {0x121a83,0x02},
    {0x121a84,0x02},
    {0x121a85,0x02},
    {0x121a86,0x02},
    {0x121a87,0x01},
    {0x121a88,0x02},
    {0x121a89,0x00},
    {0x121a8a,0x01},
    {0x121a8b,0x00},
    {0x121a8c,0x00},
    {0x121a8d,0x00},
    {0x121a8e,0x01},
    {0x121a8f,0x02},
    {0x121a90,0x01},
    {0x121a91,0x01},
    {0x121a92,0x01},
    {0x121a93,0x01},
    {0x121a94,0x01},
    {0x121a95,0x01},
    {0x121a96,0x01},
    {0x121a97,0x01},
    {0x121a98,0x01},
    {0x121a99,0x01},
    {0x121a9a,0x01},
    {0x121a9b,0x01},
    {0x121a9c,0x01},
    {0x121a9d,0x01},
    {0x121a9e,0x01},
    {0x121a9f,0x01},
    {0x121ae0,0x00},
    {0x121ae1,0x00},
    {0x121ae2,0x00},
    {0x121ae3,0x00},
    {0x121ae4,0x00},
    {0x121ae5,0x00},
    {0x121ae6,0x00},
    {0x121ae7,0x00},
    {0x121ae8,0x00},
    {0x121ae9,0x00},
    {0x121aea,0x00},
    {0x121aeb,0x00},
    {0x121aec,0x00},
    {0x121aed,0x00},
    {0x121aee,0x00},
    {0x121aef,0x00},
    {0x121af0,0x00},
    {0x121af1,0x00},
    {0x121af2,0x00},
    {0x121af3,0x00},
    {0x122194,0x28},
    {0x122195,0x20},
    {0x122196,0x00},
    {0x122197,0x00},
    {0x1221a4,0x28},
    {0x1221a5,0x22},
    {0x1221a6,0x00},
    {0x1221a7,0x00},
//MIU pre-inivec Setting    
    {0x122162,0x7f},
    {0x122163,0x00},
    {0x122164,0x00},
    {0x122165,0xf1},
    {0x122160,0xcb},
    {0x122161,0x00},
    {0x122160,0xcf},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc2},
    {0x122160,0xc0},
    {0x122160,0xc8},
    {0x122161,0x33},
    {0x122170,0x00},
    {0x122171,0x00},
    {0x122198,0x00},
    {0x122199,0x00},
    {0x12219a,0x00},
    {0x12219b,0x00},
    {0x122190,0xf3},
    {0x122191,0xf0},
    {0x122170,0x00},
    {0x122171,0x08},
    {0x121aa0,0x03},
    {0x121aa1,0x03},
    {0x121aa2,0x03},
    {0x121aa3,0x03},
    {0x121aa4,0x03},
    {0x121aa5,0x03},
    {0x121aa6,0x03},
    {0x121aa7,0x03},
    {0x121aa8,0x03},
    {0x121aa9,0x03},
    {0x121aaa,0x03},
    {0x121aab,0x03},
    {0x121aac,0x03},
    {0x121aad,0x03},
    {0x121aae,0x03},
    {0x121aaf,0x03},
    {0x121ab0,0x03},
    {0x121ab1,0x03},
    {0x121ab2,0x03},
    {0x121ab3,0x03},
    {0x12216c,0x00},
    {0x12216d,0x00},
    {0x12216e,0x04},
    {0x12216f,0x04},
    {0x122174,0x07},
    {0x122175,0x07},
    {0x122176,0x07},
    {0x122177,0x07},
    {0x12211a,0x33},
    {0x12211b,0x83},
    {0x12211c,0x20},
    {0x12211d,0x00},
    {0x122108,0x3f},
    {0x122109,0x00},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x122060,0x01},
    {0x122061,0x00},
    {0x122010,0x55},
    {0x122011,0x00},
    {0x122008,0xcc},
    {0x122009,0xcc},
    {0x12200a,0x1c},
    {0x12200b,0x00},
    {0x12200c,0x00},
    {0x12200d,0x00},
    {0x12200e,0x01},
    {0x12200f,0x00},
    {0x122076,0x20},
    {0x122077,0x00},
    {0x122078,0x0f},
    {0x122079,0x0f},
    {0x12207a,0x0f},
    {0x12207b,0x0f},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x122480,0xf0},
    {0x122481,0x80},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    //{0x1224de,0x02},
    //{0x1224df,0x80},
    {0x12201e,0x00},
    {0x12201f,0x8c},
//MIU post-inivec Setting 
    {0x12217e,0x80},
    {0x12217f,0x00},
    {0x122100,0x10},
    {0x122101,0x20},
    {0x122100,0x00},
    {0x122101,0x00},
    {0x122118,0x00},
    {0x122119,0x00},
    {0x122106,0x00},
    {0x122107,0x00},
    {0x12217c,0x05},
    {0x12217d,0x00},
    {0x122154,0x00},
    {0x122155,0xc0},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x12213e,0x00},
    {0x12213f,0x00},
//MIU DRAM init
    {0x122000,0x00},
    {0x122001,0x00},
    {0x122000,0x08},
    {0x122000,0x0c},
    {0x122000,0x0e},
    {0x122000,0x1f},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x121dec,0x00},
    {0x121ded,0xc0},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x122204,0x00},
    {0x122205,0x00},
    {0x122206,0xfe},
    {0x122207,0x7f},
    {0x12220a,0xff},
    {0x12220b,0xff},
    {0x1222fe,0x01},
    {0x1222ff,0x10},
    {0x122296,0x48},
    {0x122297,0x28},
    {0x12229a,0xb5},
    {0x12229b,0x20},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    {0x1224a0,0xf0},
    {0x1224a1,0xf2},
    {0x1224a8,0x00},
    {0x1224a9,0x03},
    {0x1224aa,0x52},
    {0x1224ab,0xcb},
    {0x1224ac,0x07},
    {0x1224ad,0x00},
    //{0x123080,0x15},
    //{0x123081,0x80},
    //{0x123300,0x15},
    //{0x123301,0x80},
    {0x1217c6,0xff},
    {0x1217c7,0x3f},
    {0x1217c8,0x00},
    {0x1217c9,0x00},
    {0x121700,0x00},
    {0x121701,0x10},
    {0x121702,0x00},
    {0x121703,0x10},
    {0x123086,0x00},
    {0x123087,0x00},
    {0x123306,0x00},
    {0x123307,0x00},
    {0x1222e6,0x00},
    {0x1222e7,0x00},
    {0x12201e,0x08},
    {0x12201f,0x0c}
};
#endif
code RegUnitType tInitMemory_ESMT_DDR2_1333_512Mb[] =
{
    {0x122030,0x00},
    {0x122031,0x00},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x1220d0,0x00},
    {0x1220d1,0x00},
//MIU Channel Config Setting
    {0x122426,0x80},
    {0x122427,0x00},
    {0x12242a,0x31},
    {0x12242b,0x00},
    {0x1220dc,0x0e},
    {0x1220dd,0x00},
    {0x122436,0xe0},
    {0x122437,0x00},
    {0x122428,0x00},
    {0x122429,0x00},
//MIU DDRPLL Setting  
    {0x12201e,0x00},
    {0x12201f,0x0c},
    {0x12201e,0x01},
    {0x1222e6,0xfe},
    {0x1222e7,0xff},
    {0x122178,0x02},
    {0x122179,0x01},
    {0x122136,0x00},
    {0x122137,0x00},
    {0x122134,0x02},
    {0x122135,0x01},
    {0x12218c,0x00},
    {0x12218d,0x04},
    {0x122130,0xd5},
    {0x122131,0xed},
    {0x122132,0x29},
    {0x122133,0x00},
    {0x12218a,0x01},
    {0x12218b,0x00},
    {0x122184,0x00},
    {0x122185,0x00},
    {0x122186,0x08},
    {0x122187,0x00},
    {0x12218c,0x00},
    {0x12218d,0x00},
    {0x122122,0x00},
    {0x122123,0x28},
    {0x12212c,0x14},
    {0x12212d,0x01},
//MIU table Setting (DDR2_4X_1333)    
    {0x122002,0x00},
    {0x122003,0x02},
    {0x122004,0x52},
    {0x122005,0x00},
    {0x122006,0x00},
    {0x122007,0x00},
    {0x122028,0x60},
    {0x122029,0x00},
    {0x122420,0x02},
    {0x122421,0x30},
    {0x122422,0x01},
    {0x122423,0x02},
    {0x122440,0x0a},
    {0x122441,0x0a},
    {0x122442,0x1e},
    {0x122443,0x07},
    {0x122444,0x07},
    {0x122445,0x27},
    {0x122446,0x08},
    {0x122447,0x0a},
    {0x122448,0x05},
    {0x122449,0x09},
    {0x12244a,0x04},
    {0x12244b,0x05},
    {0x12244c,0x2a},
    {0x12244d,0x05},
    {0x12244e,0x57},
    {0x12244f,0x00},
    {0x122450,0x00},
    {0x122451,0xe0},
    {0x122452,0x00},
    {0x122453,0x00},
    {0x122454,0x00},
    {0x122455,0x0a},
    {0x12245a,0x02},
    {0x12245b,0x08},
    //{0x12245c,0x0f},
    //{0x12245d,0x00},
    {0x12245e,0x4a},
    {0x12245f,0x03},
    {0x122460,0x03},
    {0x122461,0x00},
    {0x122462,0x40},
    {0x122463,0x40},
    {0x122464,0x00},
    {0x122465,0x80},
    {0x122466,0x00},
    {0x122467,0xc0},
    {0x122468,0x00},
    {0x122469,0x00},
    {0x12246a,0x00},
    {0x12246b,0x00},
    {0x12246c,0x00},
    {0x12246d,0x00},
    {0x122480,0x00},
    {0x122481,0x00},
    {0x122486,0x00},
    {0x122487,0x00},
    {0x122102,0xaa},
    {0x122103,0xaa},
    {0x122104,0x00},
    {0x122105,0x00},
    {0x12210e,0x8d},
    {0x12210f,0x00},
    {0x1221b6,0x00},
    {0x1221b7,0x00},
    {0x1221dc,0x0f},
    {0x1221dd,0x00},
    {0x1221e0,0x11},
    {0x1221e1,0x00},
    {0x1221e2,0x11},
    {0x1221e3,0x00},
    {0x1221e4,0x10},
    {0x1221e5,0x00},
    {0x1221e6,0x11},
    {0x1221e7,0x11},
    {0x1221e8,0x11},
    {0x1221e9,0x11},
    {0x1221ea,0x11},
    {0x1221eb,0x11},
    {0x1221ec,0x11},
    {0x1221ed,0x11},
    {0x1221ee,0x11},
    {0x1221ef,0x11},
    {0x1221f0,0x33},
    {0x1221f1,0x33},
    {0x1221f2,0x33},
    {0x1221f3,0x00},
    {0x121a00,0x02},
    {0x121a01,0x00},
    {0x121a04,0x00},
    {0x121a05,0x00},
    {0x121a08,0x00},
    {0x121a09,0x00},
    {0x121a0a,0x00},
    {0x121a0b,0x00},
    {0x121a0c,0x00},
    {0x121a0d,0x02},
    {0x121a10,0x00},
    {0x121a11,0x00},
    {0x121a12,0x00},
    {0x121a13,0x00},
    {0x121a14,0x07},
    {0x121a15,0x1f},
    {0x121a16,0x1f},
    {0x121a17,0x1f},
    {0x121a1e,0x00},
    {0x121a1f,0x00},
    {0x121a20,0x1f},
    {0x121a21,0x1f},
    {0x121a22,0x0b},
    {0x121a23,0x1f},
    {0x121a24,0x1f},
    {0x121a25,0x1f},
    {0x121a26,0x1f},
    {0x121a27,0x0b},
    {0x121a28,0x1f},
    {0x121a29,0x1f},
    {0x121a2a,0x1f},
    {0x121a2b,0x1f},
    {0x121a2c,0x0b},
    {0x121a2d,0x0b},
    {0x121a2e,0x1f},
    {0x121a2f,0x0b},
    {0x121a30,0x07},
    {0x121a31,0x07},
    {0x121a32,0x07},
    {0x121a33,0x07},
    {0x121a34,0x07},
    {0x121a35,0x07},
    {0x121a36,0x07},
    {0x121a37,0x07},
    {0x121a38,0x07},
    {0x121a39,0x07},
    {0x121a3a,0x07},
    {0x121a3b,0x07},
    {0x121a3c,0x07},
    {0x121a3d,0x07},
    {0x121a3e,0x07},
    {0x121a3f,0x07},
    {0x121a60,0x04},
    {0x121a61,0x04},
    {0x121a62,0x07},
    {0x121a63,0x07},
    {0x121a64,0x08},
    {0x121a65,0x08},
    {0x121a66,0x08},
    {0x121a67,0x08},
    {0x121a68,0x08},
    {0x121a69,0x08},
    {0x121a6a,0x08},
    {0x121a6b,0x08},
    {0x121a80,0x00},
    {0x121a81,0x00},
    {0x121a82,0x03},
    {0x121a83,0x01},
    {0x121a84,0x02},
    {0x121a85,0x02},
    {0x121a86,0x02},
    {0x121a87,0x03},
    {0x121a88,0x00},
    {0x121a89,0x00},
    {0x121a8a,0x01},
    {0x121a8b,0x01},
    {0x121a8c,0x01},
    {0x121a8d,0x00},
    {0x121a8e,0x01},
    {0x121a8f,0x01},
    {0x121a90,0x01},
    {0x121a91,0x01},
    {0x121a92,0x01},
    {0x121a93,0x01},
    {0x121a94,0x01},
    {0x121a95,0x01},
    {0x121a96,0x01},
    {0x121a97,0x01},
    {0x121a98,0x01},
    {0x121a99,0x01},
    {0x121a9a,0x01},
    {0x121a9b,0x01},
    {0x121a9c,0x01},
    {0x121a9d,0x01},
    {0x121a9e,0x01},
    {0x121a9f,0x01},
    {0x121ae0,0x00},
    {0x121ae1,0x00},
    {0x121ae2,0x00},
    {0x121ae3,0x00},
    {0x121ae4,0x00},
    {0x121ae5,0x00},
    {0x121ae6,0x00},
    {0x121ae7,0x00},
    {0x121ae8,0x00},
    {0x121ae9,0x00},
    {0x121aea,0x00},
    {0x121aeb,0x00},
    {0x121aec,0x00},
    {0x121aed,0x00},
    {0x121aee,0x00},
    {0x121aef,0x00},
    {0x121af0,0x00},
    {0x121af1,0x00},
    {0x121af2,0x00},
    {0x121af3,0x00},
    {0x122194,0x23},
    {0x122195,0x26},
    {0x122196,0x00},
    {0x122197,0x00},
    {0x1221a4,0x27},
    {0x1221a5,0x28},
    {0x1221a6,0x00},
    {0x1221a7,0x00},
//MIU pre-inivec Setting    
    {0x122162,0x7f},
    {0x122163,0x00},
    {0x122164,0x00},
    {0x122165,0xf1},
    {0x122160,0xcb},
    {0x122161,0x00},
    {0x122160,0xcf},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc2},
    {0x122160,0xc0},
    {0x122160,0xc8},
    {0x122161,0x33},
    {0x122170,0x00},
    {0x122171,0x00},
    {0x122198,0x00},
    {0x122199,0x00},
    {0x12219a,0x00},
    {0x12219b,0x00},
    {0x122190,0xf3},
    {0x122191,0xf0},
    {0x122170,0x00},
    {0x122171,0x08},
    {0x121aa0,0x03},
    {0x121aa1,0x03},
    {0x121aa2,0x03},
    {0x121aa3,0x03},
    {0x121aa4,0x03},
    {0x121aa5,0x03},
    {0x121aa6,0x03},
    {0x121aa7,0x03},
    {0x121aa8,0x03},
    {0x121aa9,0x03},
    {0x121aaa,0x03},
    {0x121aab,0x03},
    {0x121aac,0x03},
    {0x121aad,0x03},
    {0x121aae,0x03},
    {0x121aaf,0x03},
    {0x121ab0,0x03},
    {0x121ab1,0x03},
    {0x121ab2,0x03},
    {0x121ab3,0x03},
    {0x12216c,0x00},
    {0x12216d,0x00},
    {0x12216e,0x04},
    {0x12216f,0x04},
    {0x122174,0x07},
    {0x122175,0x07},
    {0x122176,0x07},
    {0x122177,0x07},
    {0x12211a,0x33},
    {0x12211b,0x83},
    {0x12211c,0x20},
    {0x12211d,0x00},
    {0x122108,0x3f},
    {0x122109,0x00},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x122060,0x01},
    {0x122061,0x00},
    {0x122010,0x55},
    {0x122011,0x00},
    {0x122008,0xcc},
    {0x122009,0xcc},
    {0x12200a,0x1c},
    {0x12200b,0x00},
    {0x12200c,0x00},
    {0x12200d,0x00},
    {0x12200e,0x01},
    {0x12200f,0x00},
    {0x122076,0x20},
    {0x122077,0x00},
    {0x122078,0x0f},
    {0x122079,0x0f},
    {0x12207a,0x0f},
    {0x12207b,0x0f},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x122480,0xf0},
    {0x122481,0x80},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    //{0x1224de,0x02},
    //{0x1224df,0x80},
    {0x12201e,0x00},
    {0x12201f,0x8c},
//MIU post-inivec Setting 
    {0x12217e,0x80},
    {0x12217f,0x00},
    {0x122100,0x10},
    {0x122101,0x20},
    {0x122100,0x00},
    {0x122101,0x00},
    {0x122118,0x00},
    {0x122119,0x00},
    {0x122106,0x00},
    {0x122107,0x00},
    {0x12217c,0x05},
    {0x12217d,0x00},
    {0x122154,0x00},
    {0x122155,0xc0},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x12213e,0x01},
    {0x12213f,0x00},
//MIU DRAM init
    {0x122000,0x00},
    {0x122001,0x00},
    {0x122000,0x08},
    {0x122000,0x0c},
    {0x122000,0x0e},
    {0x122000,0x1f},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x121dec,0x00},
    {0x121ded,0xc0},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x122204,0x00},
    {0x122205,0x00},
    {0x122206,0xfe},
    {0x122207,0x7f},
    {0x12220a,0xff},
    {0x12220b,0xff},
    {0x1222fe,0x01},
    {0x1222ff,0x10},
    {0x122296,0x48},
    {0x122297,0x28},
    {0x12229a,0xb5},
    {0x12229b,0x20},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    {0x1224a0,0xf0},
    {0x1224a1,0xf2},
    {0x1224a8,0x00},
    {0x1224a9,0x03},
    {0x1224aa,0x52},
    {0x1224ab,0xcb},
    {0x1224ac,0x07},
    {0x1224ad,0x00},
    //{0x123080,0x15},
    //{0x123081,0x80},
    //{0x123300,0x15},
    //{0x123301,0x80},
    {0x1217c6,0xff},
    {0x1217c7,0x3f},
    {0x1217c8,0x00},
    {0x1217c9,0x00},
    {0x121700,0x00},
    {0x121701,0x10},
    {0x121702,0x00},
    {0x121703,0x10},
    {0x123086,0x00},
    {0x123087,0x00},
    {0x123306,0x00},
    {0x123307,0x00},
    {0x1222e6,0x00},
    {0x1222e7,0x00},
    {0x12201e,0x08},
    {0x12201f,0x0c}
};
#if ((DRAM_TYPE == DDR2_1200_128Mb_QFP156) || (DRAM_TYPE == DDR2_QFP156))
code RegUnitType tInitMemory_WB_DDR2_1200_128Mb_QFP156[] = //QFP156
{
    {0x122030,0x00},
    {0x122031,0x00},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x1220d0,0x00},
    {0x1220d1,0x00},
//MIU Channel Config Setting
    {0x122426,0x80},
    {0x122427,0x00},
    {0x12242a,0x31},
    {0x12242b,0x00},
    {0x1220dc,0x0e},
    {0x1220dd,0x00},
    {0x122436,0xe0},
    {0x122437,0x00},
    {0x122428,0x00},
    {0x122429,0x00},
//MIU DDRPLL Setting  
    {0x12201e,0x00},
    {0x12201f,0x0c},
    {0x12201e,0x01},
    {0x1222e6,0xfe},
    {0x1222e7,0xff},
    {0x122178,0x02},
    {0x122179,0x01},
    {0x122136,0x00},
    {0x122137,0x00},
    {0x122134,0x02},
    {0x122135,0x01},
    {0x12218c,0x00},
    {0x12218d,0x04},
    {0x122130,0xa3},
    {0x122131,0x8b},
    {0x122132,0x2e},
    {0x122133,0x00},
    {0x12218a,0x01},
    {0x12218b,0x00},
    {0x122184,0x00},
    {0x122185,0x00},
    {0x122186,0x08},
    {0x122187,0x00},
    {0x12218c,0x00},
    {0x12218d,0x00},
    {0x122122,0x00},
    {0x122123,0x28},
    {0x12212c,0x14},
    {0x12212d,0x01},
//MIU table Setting (DDR2_4X_1200)    
    {0x122002,0x00},
    {0x122003,0x02},
    {0x122004,0x52},
    {0x122005,0x00},
    {0x122006,0x00},
    {0x122007,0x00},
    {0x122028,0x60},
    {0x122029,0x00},
    {0x122420,0x02},
    {0x122421,0x30},
    {0x122422,0x01},
    {0x122423,0x01},
    {0x122440,0x0a},
    {0x122441,0x0a},
    {0x122442,0x1e},
    {0x122443,0x07},
    {0x122444,0x08},
    {0x122445,0x27},
    {0x122446,0x08},
    {0x122447,0x0a},
    {0x122448,0x06},
    {0x122449,0x09},
    {0x12244a,0x04},
    {0x12244b,0x06},
    {0x12244c,0x2a},
    {0x12244d,0x05},
    {0x12244e,0x57},
    {0x12244f,0x00},
    {0x122450,0x00},
    {0x122451,0xe0},
    {0x122452,0x00},
    {0x122453,0x00},
    {0x122454,0x00},
    {0x122455,0x0a},
    {0x12245a,0x02},
    {0x12245b,0x08},
    //{0x12245c,0x0f},
    //{0x12245d,0x00},
    {0x12245e,0x4a},
    {0x12245f,0x03},
    {0x122460,0x03},
    {0x122461,0x00},
    {0x122462,0x06},
    {0x122463,0x40},
    {0x122464,0x00},
    {0x122465,0x80},
    {0x122466,0x00},
    {0x122467,0xc0},
    {0x122468,0x00},
    {0x122469,0x00},
    {0x12246a,0x00},
    {0x12246b,0x00},
    {0x12246c,0x00},
    {0x12246d,0x00},
    {0x122480,0x00},
    {0x122481,0x00},
    {0x122486,0x00},
    {0x122487,0x00},
    {0x122102,0xaa},
    {0x122103,0xaa},
    {0x122104,0x00},
    {0x122105,0x00},
    {0x12210e,0x8d},
    {0x12210f,0x00},
    {0x1221b6,0x00},
    {0x1221b7,0x00},
    {0x1221dc,0x0f},
    {0x1221dd,0x00},
    {0x1221e0,0x11},
    {0x1221e1,0x00},
    {0x1221e2,0x11},
    {0x1221e3,0x00},
    {0x1221e4,0x10},
    {0x1221e5,0x00},
    {0x1221e6,0x11},
    {0x1221e7,0x11},
    {0x1221e8,0x11},
    {0x1221e9,0x11},
    {0x1221ea,0x11},
    {0x1221eb,0x11},
    {0x1221ec,0x11},
    {0x1221ed,0x11},
    {0x1221ee,0x11},
    {0x1221ef,0x11},
    {0x1221f0,0x33},
    {0x1221f1,0x33},
    {0x1221f2,0x33},
    {0x1221f3,0x00},
    {0x121a00,0x02},
    {0x121a01,0x00},
    {0x121a04,0x00},
    {0x121a05,0x00},
    {0x121a08,0x00},
    {0x121a09,0x00},
    {0x121a0a,0x00},
    {0x121a0b,0x00},
    {0x121a0c,0x00},
    {0x121a0d,0x02},
    {0x121a10,0x00},
    {0x121a11,0x00},
    {0x121a12,0x00},
    {0x121a13,0x00},
    {0x121a14,0x08},
    {0x121a15,0x1f},
    {0x121a16,0x1f},
    {0x121a17,0x1f},
    {0x121a1e,0x00},
    {0x121a1f,0x00},
    {0x121a20,0x1f},
    {0x121a21,0x1f},
    {0x121a22,0x08},
    {0x121a23,0x1f},
    {0x121a24,0x1f},
    {0x121a25,0x1f},
    {0x121a26,0x1f},
    {0x121a27,0x08},
    {0x121a28,0x1f},
    {0x121a29,0x1f},
    {0x121a2a,0x1f},
    {0x121a2b,0x1f},
    {0x121a2c,0x0a},
    {0x121a2d,0x0a},
    {0x121a2e,0x1f},
    {0x121a2f,0x0a},
    {0x121a30,0x07},
    {0x121a31,0x07},
    {0x121a32,0x07},
    {0x121a33,0x07},
    {0x121a34,0x07},
    {0x121a35,0x07},
    {0x121a36,0x07},
    {0x121a37,0x07},
    {0x121a38,0x07},
    {0x121a39,0x07},
    {0x121a3a,0x07},
    {0x121a3b,0x07},
    {0x121a3c,0x07},
    {0x121a3d,0x07},
    {0x121a3e,0x07},
    {0x121a3f,0x07},
    {0x121a60,0x04},
    {0x121a61,0x04},
    {0x121a62,0x07},
    {0x121a63,0x07},
    {0x121a64,0x08},
    {0x121a65,0x08},
    {0x121a66,0x08},
    {0x121a67,0x08},
    {0x121a68,0x08},
    {0x121a69,0x08},
    {0x121a6a,0x08},
    {0x121a6b,0x08},
    {0x121a80,0x00},
    {0x121a81,0x02},
    {0x121a82,0x03},
    {0x121a83,0x02},
    {0x121a84,0x02},
    {0x121a85,0x01},
    {0x121a86,0x04},
    {0x121a87,0x03},
    {0x121a88,0x03},
    {0x121a89,0x08},
    {0x121a8a,0x04},
    {0x121a8b,0x07},
    {0x121a8c,0x06},
    {0x121a8d,0x03},
    {0x121a8e,0x08},
    {0x121a8f,0x03},
    {0x121a90,0x01},
    {0x121a91,0x01},
    {0x121a92,0x01},
    {0x121a93,0x01},
    {0x121a94,0x01},
    {0x121a95,0x01},
    {0x121a96,0x01},
    {0x121a97,0x01},
    {0x121a98,0x01},
    {0x121a99,0x01},
    {0x121a9a,0x01},
    {0x121a9b,0x01},
    {0x121a9c,0x01},
    {0x121a9d,0x01},
    {0x121a9e,0x01},
    {0x121a9f,0x01},
    {0x121ae0,0x00},
    {0x121ae1,0x00},
    {0x121ae2,0x00},
    {0x121ae3,0x00},
    {0x121ae4,0x00},
    {0x121ae5,0x00},
    {0x121ae6,0x00},
    {0x121ae7,0x00},
    {0x121ae8,0x00},
    {0x121ae9,0x00},
    {0x121aea,0x00},
    {0x121aeb,0x00},
    {0x121aec,0x00},
    {0x121aed,0x00},
    {0x121aee,0x00},
    {0x121aef,0x00},
    {0x121af0,0x00},
    {0x121af1,0x00},
    {0x121af2,0x00},
    {0x121af3,0x00},
    {0x122194,0x28},
    {0x122195,0x28},
    {0x122196,0x00},
    {0x122197,0x00},
    {0x1221a4,0x2a},
    {0x1221a5,0x2a},
    {0x1221a6,0x00},
    {0x1221a7,0x00},
//MIU pre-inivec Setting    
    {0x122162,0x7f},
    {0x122163,0x00},
    {0x122164,0x00},
    {0x122165,0xf1},
    {0x122160,0xcb},
    {0x122161,0x00},
    {0x122160,0xcf},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc2},
    {0x122160,0xc0},
    {0x122160,0xc8},
    {0x122161,0x33},
    {0x122170,0x00},
    {0x122171,0x00},
    {0x122198,0x00},
    {0x122199,0x00},
    {0x12219a,0x00},
    {0x12219b,0x00},
    {0x122190,0xf3},
    {0x122191,0xf0},
    {0x122170,0x00},
    {0x122171,0x08},
    {0x121aa0,0x01},
    {0x121aa1,0x01},
    {0x121aa2,0x01},
    {0x121aa3,0x01},
    {0x121aa4,0x01},
    {0x121aa5,0x01},
    {0x121aa6,0x01},
    {0x121aa7,0x01},
    {0x121aa8,0x01},
    {0x121aa9,0x01},
    {0x121aaa,0x01},
    {0x121aab,0x01},
    {0x121aac,0x01},
    {0x121aad,0x01},
    {0x121aae,0x01},
    {0x121aaf,0x01},
    {0x121ab0,0x01},
    {0x121ab1,0x01},
    {0x121ab2,0x01},
    {0x121ab3,0x01},
    {0x12216c,0x00},
    {0x12216d,0x00},
    {0x12216e,0x04},
    {0x12216f,0x04},
    {0x122174,0x04},
    {0x122175,0x04},
    {0x122176,0x04},
    {0x122177,0x04},
    {0x12211a,0x00},
    {0x12211b,0x83},
    {0x12211c,0x20},
    {0x12211d,0x00},
    {0x122108,0x3f},
    {0x122109,0x00},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x122060,0x01},
    {0x122061,0x00},
    {0x122010,0x55},
    {0x122011,0x00},
    {0x122008,0xcc},
    {0x122009,0xcc},
    {0x12200a,0x1c},
    {0x12200b,0x00},
    {0x12200c,0x00},
    {0x12200d,0x00},
    {0x12200e,0x01},
    {0x12200f,0x00},
    {0x122076,0x20},
    {0x122077,0x00},
    {0x122078,0x0f},
    {0x122079,0x0f},
    {0x12207a,0x0f},
    {0x12207b,0x0f},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x122480,0xf0},
    {0x122481,0x80},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    //{0x1224de,0x02},
    //{0x1224df,0x80},
    {0x12201e,0x00},
    {0x12201f,0x8c},
//MIU post-inivec Setting 
    {0x12217e,0x80},
    {0x12217f,0x00},
    {0x122100,0x10},
    {0x122101,0x20},
    {0x122100,0x00},
    {0x122101,0x00},
    {0x122118,0x00},
    {0x122119,0x00},
    {0x122106,0x00},
    {0x122107,0x00},
    {0x12217c,0x05},
    {0x12217d,0x00},
    {0x122154,0x00},
    {0x122155,0xc0},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x12213e,0x13},
    {0x12213f,0x00},
//MIU DRAM init
    {0x122000,0x00},
    {0x122001,0x00},
    {0x122000,0x08},
    {0x122000,0x0c},
    {0x122000,0x0e},
    {0x122000,0x1f},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x121dec,0x00},
    {0x121ded,0xc0},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x122204,0x00},
    {0x122205,0x00},
    {0x122206,0xfe},
    {0x122207,0x7f},
    {0x12220a,0xff},
    {0x12220b,0xff},
    {0x1222fe,0x01},
    {0x1222ff,0x10},
    {0x122296,0x48},
    {0x122297,0x28},
    {0x12229a,0xb5},
    {0x12229b,0x20},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    {0x1224a0,0xf0},
    {0x1224a1,0xf2},
    {0x1224a8,0x00},
    {0x1224a9,0x03},
    {0x1224aa,0x52},
    {0x1224ab,0xcb},
    {0x1224ac,0x07},
    {0x1224ad,0x00},
    //{0x123080,0x15},
    //{0x123081,0x80},
    //{0x123300,0x15},
    //{0x123301,0x80},
    {0x1217c6,0xff},
    {0x1217c7,0x0f},
    {0x1217c8,0x00},
    {0x1217c9,0x00},
    {0x121700,0x00},
    {0x121701,0x10},
    {0x121702,0x00},
    {0x121703,0x10},
    {0x123086,0x00},
    {0x123087,0x00},
    {0x123306,0x00},
    {0x123307,0x00},
    {0x1222e6,0x00},
    {0x1222e7,0x00},
    {0x12201e,0x08},
    {0x12201f,0x0c}
};
#endif
#if ((DRAM_TYPE == DDR2_1200_128Mb_QFP216) || (DRAM_TYPE == DDR2_QFP216))
code RegUnitType tInitMemory_WB_DDR2_1200_128Mb_QFP216[] = //QFP216
{
    {0x122030,0x00},
    {0x122031,0x00},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x1220d0,0x00},
    {0x1220d1,0x00},
//MIU Channel Config Setting
    {0x122426,0x80},
    {0x122427,0x00},
    {0x12242a,0x31},
    {0x12242b,0x00},
    {0x1220dc,0x0e},
    {0x1220dd,0x00},
    {0x122436,0xe0},
    {0x122437,0x00},
    {0x122428,0x00},
    {0x122429,0x00},
//MIU DDRPLL Setting  
    {0x12201e,0x00},
    {0x12201f,0x0c},
    {0x12201e,0x01},
    {0x1222e6,0xfe},
    {0x1222e7,0xff},
    {0x122178,0x02},
    {0x122179,0x01},
    {0x122136,0x00},
    {0x122137,0x00},
    {0x122134,0x02},
    {0x122135,0x01},
    {0x12218c,0x00},
    {0x12218d,0x04},
    {0x122130,0xa3},
    {0x122131,0x8b},
    {0x122132,0x2e},
    {0x122133,0x00},
    {0x12218a,0x01},
    {0x12218b,0x00},
    {0x122184,0x00},
    {0x122185,0x00},
    {0x122186,0x08},
    {0x122187,0x00},
    {0x12218c,0x00},
    {0x12218d,0x00},
    {0x122122,0x00},
    {0x122123,0x28},
    {0x12212c,0x14},
    {0x12212d,0x01},
//MIU table Setting (DDR2_4X_1200)    
    {0x122002,0x00},
    {0x122003,0x02},
    {0x122004,0x52},
    {0x122005,0x00},
    {0x122006,0x00},
    {0x122007,0x00},
    {0x122028,0x60},
    {0x122029,0x00},
    {0x122420,0x02},
    {0x122421,0x30},
    {0x122422,0x01},
    {0x122423,0x01},
    {0x122440,0x0a},
    {0x122441,0x0a},
    {0x122442,0x1e},
    {0x122443,0x07},
    {0x122444,0x08},
    {0x122445,0x27},
    {0x122446,0x08},
    {0x122447,0x0a},
    {0x122448,0x06},
    {0x122449,0x09},
    {0x12244a,0x04},
    {0x12244b,0x06},
    {0x12244c,0x2a},
    {0x12244d,0x05},
    {0x12244e,0x57},
    {0x12244f,0x00},
    {0x122450,0x00},
    {0x122451,0xe0},
    {0x122452,0x00},
    {0x122453,0x00},
    {0x122454,0x00},
    {0x122455,0x0a},
    {0x12245a,0x02},
    {0x12245b,0x08},
    //{0x12245c,0x0f},
    //{0x12245d,0x00},
    {0x12245e,0x4a},
    {0x12245f,0x03},
    {0x122460,0x03},
    {0x122461,0x00},
    {0x122462,0x06},
    {0x122463,0x40},
    {0x122464,0x00},
    {0x122465,0x80},
    {0x122466,0x00},
    {0x122467,0xc0},
    {0x122468,0x00},
    {0x122469,0x00},
    {0x12246a,0x00},
    {0x12246b,0x00},
    {0x12246c,0x00},
    {0x12246d,0x00},
    {0x122480,0x00},
    {0x122481,0x00},
    {0x122486,0x00},
    {0x122487,0x00},
    {0x122102,0xaa},
    {0x122103,0xaa},
    {0x122104,0x00},
    {0x122105,0x00},
    {0x12210e,0x8d},
    {0x12210f,0x00},
    {0x1221b6,0x00},
    {0x1221b7,0x00},
    {0x1221dc,0x0f},
    {0x1221dd,0x00},
    {0x1221e0,0x11},
    {0x1221e1,0x00},
    {0x1221e2,0x11},
    {0x1221e3,0x00},
    {0x1221e4,0x10},
    {0x1221e5,0x00},
    {0x1221e6,0x11},
    {0x1221e7,0x11},
    {0x1221e8,0x11},
    {0x1221e9,0x11},
    {0x1221ea,0x11},
    {0x1221eb,0x11},
    {0x1221ec,0x11},
    {0x1221ed,0x11},
    {0x1221ee,0x11},
    {0x1221ef,0x11},
    {0x1221f0,0x33},
    {0x1221f1,0x33},
    {0x1221f2,0x33},
    {0x1221f3,0x00},
    {0x121a00,0x02},
    {0x121a01,0x00},
    {0x121a04,0x00},
    {0x121a05,0x00},
    {0x121a08,0x00},
    {0x121a09,0x00},
    {0x121a0a,0x00},
    {0x121a0b,0x00},
    {0x121a0c,0x00},
    {0x121a0d,0x02},
    {0x121a10,0x00},
    {0x121a11,0x00},
    {0x121a12,0x00},
    {0x121a13,0x00},
    {0x121a14,0x08},
    {0x121a15,0x1f},
    {0x121a16,0x1f},
    {0x121a17,0x1f},
    {0x121a1e,0x00},
    {0x121a1f,0x00},
    {0x121a20,0x1f},
    {0x121a21,0x1f},
    {0x121a22,0x08},
    {0x121a23,0x1f},
    {0x121a24,0x1f},
    {0x121a25,0x1f},
    {0x121a26,0x1f},
    {0x121a27,0x08},
    {0x121a28,0x1f},
    {0x121a29,0x1f},
    {0x121a2a,0x1f},
    {0x121a2b,0x1f},
    {0x121a2c,0x08},
    {0x121a2d,0x08},
    {0x121a2e,0x1f},
    {0x121a2f,0x08},
    {0x121a30,0x07},
    {0x121a31,0x07},
    {0x121a32,0x07},
    {0x121a33,0x07},
    {0x121a34,0x07},
    {0x121a35,0x07},
    {0x121a36,0x07},
    {0x121a37,0x07},
    {0x121a38,0x07},
    {0x121a39,0x07},
    {0x121a3a,0x07},
    {0x121a3b,0x07},
    {0x121a3c,0x07},
    {0x121a3d,0x07},
    {0x121a3e,0x07},
    {0x121a3f,0x07},
    {0x121a60,0x04},
    {0x121a61,0x04},
    {0x121a62,0x07},
    {0x121a63,0x07},
    {0x121a64,0x08},
    {0x121a65,0x08},
    {0x121a66,0x08},
    {0x121a67,0x08},
    {0x121a68,0x08},
    {0x121a69,0x08},
    {0x121a6a,0x08},
    {0x121a6b,0x08},
    {0x121a80,0x00},
    {0x121a81,0x02},
    {0x121a82,0x03},
    {0x121a83,0x02},
    {0x121a84,0x02},
    {0x121a85,0x01},
    {0x121a86,0x04},
    {0x121a87,0x03},
    {0x121a88,0x03},
    {0x121a89,0x08},
    {0x121a8a,0x04},
    {0x121a8b,0x07},
    {0x121a8c,0x06},
    {0x121a8d,0x03},
    {0x121a8e,0x08},
    {0x121a8f,0x03},
    {0x121a90,0x01},
    {0x121a91,0x01},
    {0x121a92,0x01},
    {0x121a93,0x01},
    {0x121a94,0x01},
    {0x121a95,0x01},
    {0x121a96,0x01},
    {0x121a97,0x01},
    {0x121a98,0x01},
    {0x121a99,0x01},
    {0x121a9a,0x01},
    {0x121a9b,0x01},
    {0x121a9c,0x01},
    {0x121a9d,0x01},
    {0x121a9e,0x01},
    {0x121a9f,0x01},
    {0x121ae0,0x00},
    {0x121ae1,0x00},
    {0x121ae2,0x00},
    {0x121ae3,0x00},
    {0x121ae4,0x00},
    {0x121ae5,0x00},
    {0x121ae6,0x00},
    {0x121ae7,0x00},
    {0x121ae8,0x00},
    {0x121ae9,0x00},
    {0x121aea,0x00},
    {0x121aeb,0x00},
    {0x121aec,0x00},
    {0x121aed,0x00},
    {0x121aee,0x00},
    {0x121aef,0x00},
    {0x121af0,0x00},
    {0x121af1,0x00},
    {0x121af2,0x00},
    {0x121af3,0x00},
    {0x122194,0x28},
    {0x122195,0x28},
    {0x122196,0x00},
    {0x122197,0x00},
    {0x1221a4,0x2a},
    {0x1221a5,0x2a},
    {0x1221a6,0x00},
    {0x1221a7,0x00},
//MIU pre-inivec Setting    
    {0x122162,0x7f},
    {0x122163,0x00},
    {0x122164,0x00},
    {0x122165,0xf1},
    {0x122160,0xcb},
    {0x122161,0x00},
    {0x122160,0xcf},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc2},
    {0x122160,0xc0},
    {0x122160,0xc8},
    {0x122161,0x33},
    {0x122170,0x00},
    {0x122171,0x00},
    {0x122198,0x00},
    {0x122199,0x00},
    {0x12219a,0x00},
    {0x12219b,0x00},
    {0x122190,0xf3},
    {0x122191,0xf0},
    {0x122170,0x00},
    {0x122171,0x08},
    {0x121aa0,0x01},
    {0x121aa1,0x01},
    {0x121aa2,0x01},
    {0x121aa3,0x01},
    {0x121aa4,0x01},
    {0x121aa5,0x01},
    {0x121aa6,0x01},
    {0x121aa7,0x01},
    {0x121aa8,0x01},
    {0x121aa9,0x01},
    {0x121aaa,0x01},
    {0x121aab,0x01},
    {0x121aac,0x01},
    {0x121aad,0x01},
    {0x121aae,0x01},
    {0x121aaf,0x01},
    {0x121ab0,0x01},
    {0x121ab1,0x01},
    {0x121ab2,0x01},
    {0x121ab3,0x01},
    {0x12216c,0x00},
    {0x12216d,0x00},
    {0x12216e,0x04},
    {0x12216f,0x04},
    {0x122174,0x04},
    {0x122175,0x04},
    {0x122176,0x04},
    {0x122177,0x04},
    {0x12211a,0x00},
    {0x12211b,0x83},
    {0x12211c,0x20},
    {0x12211d,0x00},
    {0x122108,0x3f},
    {0x122109,0x00},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x122060,0x01},
    {0x122061,0x00},
    {0x122010,0x55},
    {0x122011,0x00},
    {0x122008,0xcc},
    {0x122009,0xcc},
    {0x12200a,0x1c},
    {0x12200b,0x00},
    {0x12200c,0x00},
    {0x12200d,0x00},
    {0x12200e,0x01},
    {0x12200f,0x00},
    {0x122076,0x20},
    {0x122077,0x00},
    {0x122078,0x0f},
    {0x122079,0x0f},
    {0x12207a,0x0f},
    {0x12207b,0x0f},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x122480,0xf0},
    {0x122481,0x80},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    //{0x1224de,0x02},
    //{0x1224df,0x80},
    {0x12201e,0x00},
    {0x12201f,0x8c},
//MIU post-inivec Setting 
    {0x12217e,0x80},
    {0x12217f,0x00},
    {0x122100,0x10},
    {0x122101,0x20},
    {0x122100,0x00},
    {0x122101,0x00},
    {0x122118,0x00},
    {0x122119,0x00},
    {0x122106,0x00},
    {0x122107,0x00},
    {0x12217c,0x05},
    {0x12217d,0x00},
    {0x122154,0x00},
    {0x122155,0xc0},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x12213e,0x13},
    {0x12213f,0x00},
//MIU DRAM init
    {0x122000,0x00},
    {0x122001,0x00},
    {0x122000,0x08},
    {0x122000,0x0c},
    {0x122000,0x0e},
    {0x122000,0x1f},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x121dec,0x00},
    {0x121ded,0xc0},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x122204,0x00},
    {0x122205,0x00},
    {0x122206,0xfe},
    {0x122207,0x7f},
    {0x12220a,0xff},
    {0x12220b,0xff},
    {0x1222fe,0x01},
    {0x1222ff,0x10},
    {0x122296,0x48},
    {0x122297,0x28},
    {0x12229a,0xb5},
    {0x12229b,0x20},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    {0x1224a0,0xf0},
    {0x1224a1,0xf2},
    {0x1224a8,0x00},
    {0x1224a9,0x03},
    {0x1224aa,0x52},
    {0x1224ab,0xcb},
    {0x1224ac,0x07},
    {0x1224ad,0x00},
    //{0x123080,0x15},
    //{0x123081,0x80},
    //{0x123300,0x15},
    //{0x123301,0x80},
    {0x1217c6,0xff},
    {0x1217c7,0x0f},
    {0x1217c8,0x00},
    {0x1217c9,0x00},
    {0x121700,0x00},
    {0x121701,0x10},
    {0x121702,0x00},
    {0x121703,0x10},
    {0x123086,0x00},
    {0x123087,0x00},
    {0x123306,0x00},
    {0x123307,0x00},
    {0x1222e6,0x00},
    {0x1222e7,0x00},
    {0x12201e,0x08},
    {0x12201f,0x0c}
};
#endif
code RegUnitType tInitMemory_ESMT_DDR2_1200_128Mb[] =
{
    {0x122030,0x00},
    {0x122031,0x00},
    {0x1224dc,0x0a},
    {0x1224dd,0x00},
    {0x1220d0,0x00},
    {0x1220d1,0x00},
//MIU Channel Config Setting
    {0x122426,0x80},
    {0x122427,0x00},
    {0x12242a,0x31},
    {0x12242b,0x00},
    {0x1220dc,0x0e},
    {0x1220dd,0x00},
    {0x122436,0xe0},
    {0x122437,0x00},
    {0x122428,0x00},
    {0x122429,0x00},
//MIU DDRPLL Setting  
    {0x12201e,0x00},
    {0x12201f,0x0c},
    {0x12201e,0x01},
    {0x1222e6,0xfe},
    {0x1222e7,0xff},
    {0x122178,0x02},
    {0x122179,0x01},
    {0x122136,0x00},
    {0x122137,0x00},
    {0x122134,0x02},
    {0x122135,0x01},
    {0x12218c,0x00},
    {0x12218d,0x04},
    {0x122130,0xa3},
    {0x122131,0x8b},
    {0x122132,0x2e},
    {0x122133,0x00},
    {0x12218a,0x01},
    {0x12218b,0x00},
    {0x122184,0x00},
    {0x122185,0x00},
    {0x122186,0x08},
    {0x122187,0x00},
    {0x12218c,0x00},
    {0x12218d,0x00},
    {0x122122,0x00},
    {0x122123,0x28},
    {0x12212c,0x14},
    {0x12212d,0x01},
//MIU table Setting (DDR2_4X_1200)    
    {0x122002,0x00},
    {0x122003,0x02},
    {0x122004,0x4f},
    {0x122005,0x00},
    {0x122006,0x00},
    {0x122007,0x00},
    {0x122028,0x40},
    {0x122029,0x00},
    {0x122420,0x02},
    {0x122421,0x30},
    {0x122422,0x01},
    {0x122423,0x01},
    {0x122440,0x0a},
    {0x122441,0x0a},
    {0x122442,0x1e},
    {0x122443,0x07},
    {0x122444,0x08},
    {0x122445,0x27},
    {0x122446,0x06},
    {0x122447,0x0a},
    {0x122448,0x06},
    {0x122449,0x09},
    {0x12244a,0x04},
    {0x12244b,0x05},
    {0x12244c,0x2a},
    {0x12244d,0x05},
    {0x12244e,0x57},
    {0x12244f,0x00},
    {0x122450,0x00},
    {0x122451,0xe0},
    {0x122452,0x00},
    {0x122453,0x00},
    {0x122454,0x00},
    {0x122455,0x0a},
    {0x12245a,0x02},
    {0x12245b,0x08},
    //{0x12245c,0x0f},
    //{0x12245d,0x00},
    {0x12245e,0x4a},
    {0x12245f,0x03},
    {0x122460,0x73},
    {0x122461,0x00},
    {0x122462,0x42},
    {0x122463,0x40},
    {0x122464,0x00},
    {0x122465,0x80},
    {0x122466,0x00},
    {0x122467,0xc0},
    {0x122468,0x00},
    {0x122469,0x00},
    {0x12246a,0x00},
    {0x12246b,0x00},
    {0x12246c,0x00},
    {0x12246d,0x00},
    {0x122480,0x00},
    {0x122481,0x00},
    {0x122486,0x00},
    {0x122487,0x00},
    {0x122102,0xaa},
    {0x122103,0xaa},
    {0x122104,0x00},
    {0x122105,0x00},
    {0x12210e,0x89},
    {0x12210f,0x00},
    {0x1221b6,0x00},
    {0x1221b7,0x00},
    {0x1221dc,0x0f},
    {0x1221dd,0x00},
    {0x1221e0,0x11},
    {0x1221e1,0x00},
    {0x1221e2,0x11},
    {0x1221e3,0x00},
    {0x1221e4,0x10},
    {0x1221e5,0x00},
    {0x1221e6,0x11},
    {0x1221e7,0x11},
    {0x1221e8,0x11},
    {0x1221e9,0x11},
    {0x1221ea,0x11},
    {0x1221eb,0x11},
    {0x1221ec,0x11},
    {0x1221ed,0x11},
    {0x1221ee,0x11},
    {0x1221ef,0x11},
    {0x1221f0,0x33},
    {0x1221f1,0x33},
    {0x1221f2,0x33},
    {0x1221f3,0x00},
    {0x121a00,0x02},
    {0x121a01,0x00},
    {0x121a04,0x00},
    {0x121a05,0x00},
    {0x121a08,0x00},
    {0x121a09,0x00},
    {0x121a0a,0x00},
    {0x121a0b,0x00},
    {0x121a0c,0x02},
    {0x121a0d,0x02},
    {0x121a10,0x00},
    {0x121a11,0x00},
    {0x121a12,0x00},
    {0x121a13,0x00},
    {0x121a14,0x07},
    {0x121a15,0x1f},
    {0x121a16,0x1f},
    {0x121a17,0x1f},
    {0x121a1e,0x00},
    {0x121a1f,0x00},
    {0x121a20,0x1f},
    {0x121a21,0x1f},
    {0x121a22,0x0b},
    {0x121a23,0x1f},
    {0x121a24,0x1f},
    {0x121a25,0x1f},
    {0x121a26,0x1f},
    {0x121a27,0x0b},
    {0x121a28,0x1f},
    {0x121a29,0x1f},
    {0x121a2a,0x1f},
    {0x121a2b,0x1f},
    {0x121a2c,0x0b},
    {0x121a2d,0x0b},
    {0x121a2e,0x1f},
    {0x121a2f,0x0b},
    {0x121a30,0x07},
    {0x121a31,0x07},
    {0x121a32,0x07},
    {0x121a33,0x07},
    {0x121a34,0x07},
    {0x121a35,0x07},
    {0x121a36,0x07},
    {0x121a37,0x07},
    {0x121a38,0x07},
    {0x121a39,0x07},
    {0x121a3a,0x07},
    {0x121a3b,0x07},
    {0x121a3c,0x07},
    {0x121a3d,0x07},
    {0x121a3e,0x07},
    {0x121a3f,0x07},
    {0x121a60,0x05},
    {0x121a61,0x05},
    {0x121a62,0x07},
    {0x121a63,0x07},
    {0x121a64,0x08},
    {0x121a65,0x08},
    {0x121a66,0x08},
    {0x121a67,0x08},
    {0x121a68,0x08},
    {0x121a69,0x08},
    {0x121a6a,0x08},
    {0x121a6b,0x08},
    {0x121a80,0x04},
    {0x121a81,0x04},
    {0x121a82,0x01},
    {0x121a83,0x02},
    {0x121a84,0x05},
    {0x121a85,0x04},
    {0x121a86,0x03},
    {0x121a87,0x00},
    {0x121a88,0x06},
    {0x121a89,0x02},
    {0x121a8a,0x01},
    {0x121a8b,0x04},
    {0x121a8c,0x04},
    {0x121a8d,0x03},
    {0x121a8e,0x00},
    {0x121a8f,0x03},
    {0x121a90,0x01},
    {0x121a91,0x01},
    {0x121a92,0x01},
    {0x121a93,0x01},
    {0x121a94,0x01},
    {0x121a95,0x01},
    {0x121a96,0x01},
    {0x121a97,0x01},
    {0x121a98,0x01},
    {0x121a99,0x01},
    {0x121a9a,0x01},
    {0x121a9b,0x01},
    {0x121a9c,0x01},
    {0x121a9d,0x01},
    {0x121a9e,0x01},
    {0x121a9f,0x01},
    {0x121ae0,0x00},
    {0x121ae1,0x00},
    {0x121ae2,0x00},
    {0x121ae3,0x00},
    {0x121ae4,0x00},
    {0x121ae5,0x00},
    {0x121ae6,0x00},
    {0x121ae7,0x00},
    {0x121ae8,0x00},
    {0x121ae9,0x00},
    {0x121aea,0x00},
    {0x121aeb,0x00},
    {0x121aec,0x00},
    {0x121aed,0x00},
    {0x121aee,0x00},
    {0x121aef,0x00},
    {0x121af0,0x00},
    {0x121af1,0x00},
    {0x121af2,0x00},
    {0x121af3,0x00},
    {0x122194,0x27},
    {0x122195,0x24},
    {0x122196,0x00},
    {0x122197,0x00},
    {0x1221a4,0x22},
    {0x1221a5,0x20},
    {0x1221a6,0x00},
    {0x1221a7,0x00},
//MIU pre-inivec Setting    
    {0x122162,0x7f},
    {0x122163,0x00},
    {0x122164,0x00},
    {0x122165,0xf1},
    {0x122160,0xcb},
    {0x122161,0x00},
    {0x122160,0xcf},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc3},
    {0x122160,0xcb},
    {0x122160,0xc2},
    {0x122160,0xc0},
    {0x122160,0xc8},
    {0x122161,0x33},
    {0x122170,0x00},
    {0x122171,0x00},
    {0x122198,0x00},
    {0x122199,0x00},
    {0x12219a,0x00},
    {0x12219b,0x00},
    {0x122190,0xf3},
    {0x122191,0xf0},
    {0x122170,0x00},
    {0x122171,0x08},
    {0x121aa0,0x03},
    {0x121aa1,0x03},
    {0x121aa2,0x03},
    {0x121aa3,0x03},
    {0x121aa4,0x03},
    {0x121aa5,0x03},
    {0x121aa6,0x03},
    {0x121aa7,0x03},
    {0x121aa8,0x03},
    {0x121aa9,0x03},
    {0x121aaa,0x03},
    {0x121aab,0x03},
    {0x121aac,0x03},
    {0x121aad,0x03},
    {0x121aae,0x03},
    {0x121aaf,0x03},
    {0x121ab0,0x03},
    {0x121ab1,0x03},
    {0x121ab2,0x03},
    {0x121ab3,0x03},
    {0x12216c,0x00},
    {0x12216d,0x00},
    {0x12216e,0x04},
    {0x12216f,0x04},
    {0x122174,0x04},
    {0x122175,0x04},
    {0x122176,0x04},
    {0x122177,0x04},
    {0x12211a,0x00},
    {0x12211b,0x83},
    {0x12211c,0x20},
    {0x12211d,0x00},
    {0x122108,0x3f},
    {0x122109,0x00},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x122060,0x01},
    {0x122061,0x00},
    {0x122010,0x55},
    {0x122011,0x00},
    {0x122008,0xcc},
    {0x122009,0xcc},
    {0x12200a,0x1c},
    {0x12200b,0x00},
    {0x12200c,0x00},
    {0x12200d,0x00},
    {0x12200e,0x01},
    {0x12200f,0x00},
    {0x122076,0x20},
    {0x122077,0x00},
    {0x122078,0x0f},
    {0x122079,0x0f},
    {0x12207a,0x0f},
    {0x12207b,0x0f},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    {0x122480,0xf0},
    {0x122481,0x80},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    //{0x1224de,0x02},
    //{0x1224df,0x80},
    {0x12201e,0x00},
    {0x12201f,0x8c},
//MIU post-inivec Setting 
    {0x12217e,0x80},
    {0x12217f,0x00},
    {0x122100,0x10},
    {0x122101,0x20},
    {0x122100,0x00},
    {0x122101,0x00},
    {0x122118,0x00},
    {0x122119,0x00},
    {0x122106,0x00},
    {0x122107,0x00},
    {0x12217c,0x05},
    {0x12217d,0x00},
    {0x122154,0x00},
    {0x122155,0xc0},
    {0x12211e,0x05},
    {0x12211f,0x00},
    {0x12211e,0x0f},
    {0x12211e,0x05},
    {0x12213e,0x02},
    {0x12213f,0x00},
//MIU DRAM init
    {0x122000,0x00},
    {0x122001,0x00},
    {0x122000,0x08},
    {0x122000,0x0c},
    {0x122000,0x0e},
    {0x122000,0x1f},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x121dec,0x00},
    {0x121ded,0xc0},
    {0x1224c8,0x00},
    {0x1224c9,0x00},
    {0x122204,0x00},
    {0x122205,0x00},
    {0x122206,0xfe},
    {0x122207,0x7f},
    {0x12220a,0xff},
    {0x12220b,0xff},
    {0x1222fe,0x01},
    {0x1222ff,0x10},
    {0x122296,0x48},
    {0x122297,0x28},
    {0x12229a,0xb5},
    {0x12229b,0x20},
    {0x122488,0x00},
    {0x122489,0x18},
    {0x12248a,0x13},
    {0x12248b,0xff},
    //{0x1224dc,0x0a},
    //{0x1224dd,0x00},
    {0x122034,0x20},
    {0x122035,0xaf},
    {0x122036,0x20},
    {0x122037,0x88},
    {0x122038,0x0f},
    {0x122039,0x00},
    //{0x122030,0x20},
    //{0x122031,0xd0},
    {0x1224a0,0xf0},
    {0x1224a1,0xf2},
    {0x1224a8,0x00},
    {0x1224a9,0x03},
    {0x1224aa,0x52},
    {0x1224ab,0xcb},
    {0x1224ac,0x07},
    {0x1224ad,0x00},
    //{0x123080,0x15},
    //{0x123081,0x80},
    //{0x123300,0x15},
    //{0x123301,0x80},
    {0x1217c6,0xff},
    {0x1217c7,0x0f},
    {0x1217c8,0x00},
    {0x1217c9,0x00},
    {0x121700,0x00},
    {0x121701,0x10},
    {0x121702,0x00},
    {0x121703,0x10},
    {0x123086,0x00},
    {0x123087,0x00},
    {0x123306,0x00},
    {0x123307,0x00},
    {0x1222e6,0x00},
    {0x1222e7,0x00},
    {0x12201e,0x08},
    {0x12201f,0x0c}
};
#endif

Bool msMemoryBist(void)
{
    BYTE xdata i, bist_try;
    WORD xdata u16TestMode, u16ExtraMode;
    BOOL xdata bReturn = 0;
    DWORD xdata u32BistSize = 0x1000;

    bist_try = 10;
    u16TestMode  = (BIT2|BIT1); //BIST test mode [2:1]
    u16ExtraMode = u16TestMode;

    MSFB_printData("(BIST_SIZE = 0x%x)", (unsigned int)u32BistSize);

    msWrite2Byte(0x123086, 0x7FFE); //mask group0 other request
    msWrite2Byte(0x123306, 0xFFFF); //mask group4 other request

    //DQS reset
    msWrite2Byte(0x12210E, msRead2Byte(0x12210E)|BIT6);
    msWrite2Byte(0x12210E, msRead2Byte(0x12210E)&~BIT6);
//-------------
//miu self test
//-------------
    msWrite2Byte(0x1220E0, 0x0000);
    msWriteByteMask(0x122003, 0x00, 0x08);

    msWrite2Byte(0x1220E0, 0x0000);
    msWrite2Byte(0x1220E2, 0x0000/BIST_BASE_UNIT);      //test base address
    msWrite4Byte(0x1220E4, u32BistSize/MIU_UNIT);       //test length
    msWrite2Byte(0x1220E8, 0xff00);                     //test pattern

    msWrite2Byte(0x1220E0, u16ExtraMode);
    ForceDelay1ms(1);
    msWrite2Byte(0x1220E0, u16ExtraMode|BIT0);

    for (i = 0; i < bist_try; i++)
    {
        const DWORD xdata BIST_TRY_MAX = 100;
        DWORD xdata u32BistTry = 0;

        while(!(msRead2Byte(0x1220E0)&BIT15) && (u32BistTry++ < BIST_TRY_MAX));

        if (!(msRead2Byte(0x1220E0)&0x6000) && (msRead2Byte(0x1220E0)&BIT15))
        {
            MSFB_printData("try(%d) passed...", i);
            bReturn = TRUE;
            break;
        }
        MSFB_printData("bist = 0x%x", msRead2Byte(0x1220E0));
        msWrite2Byte(0x1220E0, u16ExtraMode);
        ForceDelay1ms(1);
        msWrite2Byte(0x1220E0, u16ExtraMode|BIT0);
    }

    if (i >= bist_try)
    {
        MSFB_printMsg("failed...\r\n\r\n");
        bReturn = FALSE;
    }

    msWrite2Byte(0x123086, 0x0000); //unmask group0 other request
    msWrite2Byte(0x123306, 0x0000); //unmask group4 other request

    return bReturn;
}

#if ENABLE_SW_AUTOK
static void msAutoDQSMask(void)
{
    BYTE u8Delay = 0;
    BYTE u8Skew_LB = 0, u8Skew_HB = 0;
    BYTE u8SkewOffset_LB = 0, u8SkewOffset_HB = 0;
    WORD u16Phase_LB = 0, u16Phase_HB = 0;
    WORD u16Phase_LB_Min = 0, u16Phase_HB_Min = 0;
    WORD u16Phase_LB_Max = 0, u16Phase_HB_Max = 0;
    BOOL bBistResult[2][30];
    BYTE i, cnt0, cnt1;

    // initial setting
    msWriteBit(0x122101, 0, BIT0);

    // Get default delay/skew/phase
    u8Delay = ((msReadByte(0x12210E)&0x3E)>>1);
    u8Skew_LB = (msReadByte(0x1221F0)&0x0F);
    u8Skew_HB = ((msReadByte(0x1221F0)&0xF0)>>4);
    u8SkewOffset_LB = (msReadByte(0x121AF0)&0x0F);
    u8SkewOffset_HB = ((msReadByte(0x121AF0)&0xF0)>>4);
    u16Phase_LB = (msReadByte(0x121A60)&0x0F); 
    u16Phase_HB = (msReadByte(0x121A61)&0x0F);

    if(u8SkewOffset_LB != 0)
    {
        u8Skew_LB += u8SkewOffset_LB;
        u8SkewOffset_LB = 0;
    }

    if(u8SkewOffset_HB != 0)
    {
        u8Skew_HB += u8SkewOffset_HB;
        u8SkewOffset_HB = 0;
    }

    u16Phase_LB_Min = (u8Delay*2 + (u8Skew_LB-1))*10;
    u16Phase_HB_Min = (u8Delay*2 + (u8Skew_HB-1))*10;

    // Test range is +-1 Skew with phase0~9 (total 30 phase)
    for(i=0;i<30;i++)
    {
        u16Phase_LB = u16Phase_LB_Min + i;
        u16Phase_HB = u16Phase_HB_Min + i;

        u8Skew_LB = u16Phase_LB/10;
        u8Skew_HB = u16Phase_HB/10;
        u16Phase_LB %= 10;
        u16Phase_HB %= 10;

        u8Delay = u8Skew_LB/2;
        u8Skew_LB %= 2;
        u8Skew_HB %= 2;

        msWriteByteMask(0x12210E, u8Delay<<1, 0x3E);
        msWriteByte(0x1221F0, (u8Skew_HB<<4)|u8Skew_LB);
        msWriteByteMask(0x121A60, u16Phase_LB, 0x0F);
        msWriteByteMask(0x121A61, u16Phase_HB, 0x0F);

        msWrite2Byte(0x1220E0, 0x0000);
        msWrite2Byte(0x1220E2, 0x0000);      //test base address
        msWrite4Byte(0x1220E4, 0x2001);      //test length
        msWrite2Byte(0x1220E8, 0x5AA5);      //test pattern

        msWrite2Byte(0x1220E0, 0x0006);
        ForceDelay1ms(1);
        msWrite2Byte(0x1220E0, 0x0007);
        ForceDelay1ms(1);
        
        bBistResult[0][i] = (msReadByte(0x1220A0)==0)?TRUE:FALSE;
        bBistResult[1][i] = (msReadByte(0x1220A1)==0)?TRUE:FALSE;
    }

    u16Phase_LB = u16Phase_LB_Min;
    u16Phase_HB = u16Phase_HB_Min;

    // Calculate center phase (Pass phase start with 1x and 3o)
    cnt0 = 0;
    cnt1 = 0;
    for(i=0;i<30;i++)
    {
        if(bBistResult[0][i] == TRUE)
            cnt0++;
        else
            cnt0 = 0;

        if(cnt0 == 3)
            u16Phase_LB_Min = i-2;

        if((cnt1 > 2) && (cnt0 == 0))
        {
            u16Phase_LB_Max = i-1;
            break;
        }
        else if(i == 29)
        {
            u16Phase_LB_Max = i;
        }
        
        cnt1 = cnt0;
    }

    cnt0 = 0;
    cnt1 = 0;
    for(i=0;i<30;i++)
    {
        if(bBistResult[1][i] == TRUE)
            cnt0++;
        else
            cnt0 = 0;
    
        if(cnt0 == 3)
            u16Phase_HB_Min = i-2;
    
        if((cnt1 > 2) && (cnt0 == 0))
        {
            u16Phase_HB_Max = i-1;
            break;
        }
        else if(i == 29)
        {
            u16Phase_HB_Max = i;
        }

        cnt1 = cnt0;
    }

    // Update Phase
    u16Phase_LB = u16Phase_LB + (u16Phase_LB_Min + u16Phase_LB_Max)/2;
    u16Phase_HB = u16Phase_HB + (u16Phase_HB_Min + u16Phase_HB_Max)/2;
    u8Skew_LB = u16Phase_LB/10;
    u8Skew_HB = u16Phase_HB/10;
    u16Phase_LB %= 10;
    u16Phase_HB %= 10;
    
    u8Delay = u8Skew_LB/2;
    u8Skew_LB %= 2;
    u8Skew_HB %= 2;
    
    msWriteByteMask(0x12210E, u8Delay<<1, 0x3E);
    msWriteByte(0x1221F0, (u8Skew_HB<<4)|u8Skew_LB);
    msWriteByteMask(0x121A60, u16Phase_LB, 0x0F);
    msWriteByteMask(0x121A61, u16Phase_HB, 0x0F);
    MSFB_printData("DQS MASK Delay %d ", u8Delay);
    MSFB_printData("DQS MASK Skew_LB %d ", u8Skew_LB);
    MSFB_printData("DQS MASK Skew_HB %d ", u8Skew_HB);
    MSFB_printData("DQS MASK Phase_LB %d ", u16Phase_LB);
    MSFB_printData("DQS MASK Phase_HB %d ", u16Phase_HB);

}
#endif

#define DQSN_4(value)   (value>>4)
void msAutoDQSPhase(void)
{
#if ENABLE_SW_AUTOK
    WORD u16Kcode = 0, u16PhaseMax = 0;
    BYTE u8DLL0_Even = 0, u8DLL0_Odd = 0, u8DLL1_Even = 0, u8DLL1_Odd = 0;
    WORD u16DLL0Even_Min = 0, u16DLL0Odd_Min = 0, u16DLL1Even_Min = 0, u16DLL1Odd_Min = 0;
    WORD u16DLL0Even_Max = 0, u16DLL0Odd_Max = 0, u16DLL1Even_Max = 0, u16DLL1Odd_Max = 0;
    BOOL bDLL0Even_Result[128]={0}, bDLL0Odd_Result[128]={0}, bDLL1Even_Result[128]={0}, bDLL1Odd_Result[128]={0};
    BYTE i, cnt0, cnt1;

    msAutoDQSMask();

    // initial setting
    msWriteByteMask(0x122190, 0, BIT1|BIT0);

    // Get Kcode
    u16Kcode = (msRead2Byte(0x122166)&0x3FF);
    MSFB_printData("u16Kcode = 0x%x\r\n", u16Kcode);

    // Phase test
    u16PhaseMax = MIN((u16Kcode*2),0x7F);
    for(i=0;i<=u16PhaseMax;i++)
    {
        msWriteBit(0x122171, 0, BIT3);
        msWriteByteMask(0x121A64, i, 0x7F);
        msWriteByteMask(0x121A65, i, 0x7F);
        msWriteByteMask(0x121A68, i, 0x7F);
        msWriteByteMask(0x121A69, i, 0x7F);
        
        msWriteBit(0x122171, BIT3, BIT3);
        msWrite2Byte(0x1220E0, 0x0000);
        msWrite2Byte(0x1220E2, 0x0000);      //test base address
        msWrite4Byte(0x1220E4, 0x2001);      //test length
        msWrite2Byte(0x1220E8, 0x5AA5);      //test pattern

        msWrite2Byte(0x1220E0, 0x0006);
        ForceDelay1ms(1);
        msWrite2Byte(0x1220E0, 0x0007);
        cnt0 = 0;
        while((msReadByte(0x1220E1)&BIT7)==0)
        {
            ForceDelay1ms(1);
            cnt0++;

            if(cnt0 > 10)
                break;
        }
        
        bDLL0Even_Result[i] = ((msReadByte(0x1220A4)==0)?TRUE:FALSE);
        bDLL1Even_Result[i] = ((msReadByte(0x1220A5)==0)?TRUE:FALSE);
        bDLL0Odd_Result[i] = ((msReadByte(0x1220A8)==0)?TRUE:FALSE);
        bDLL1Odd_Result[i] = ((msReadByte(0x1220A9)==0)?TRUE:FALSE);
    }
    
    // Recover setting
    msWriteBit(0x122171, 0, BIT3);
    msWriteByteMask(0x121A64, 0x08, 0x7F);
    msWriteByteMask(0x121A65, 0x08, 0x7F);
    msWriteByteMask(0x121A68, 0x08, 0x7F);
    msWriteByteMask(0x121A69, 0x08, 0x7F);
    msWriteBit(0x122171, BIT3, BIT3);
    msWriteByteMask(0x122190, 0x03, BIT1|BIT0);

    // Calculate center phase (Pass phase start with 1x and 3o)
    cnt0 = 0;
    cnt1 = 0;
    for(i=0;i<=u16PhaseMax;i++)
    {
        if(bDLL0Even_Result[i] == TRUE)
            cnt0++;
        else
            cnt0 = 0;
    
        if(cnt0 == 3)
            u16DLL0Even_Min = i-2;
    
        if((cnt1 > 2) && (cnt0 == 0))
        {
            u16DLL0Even_Max= i-1;
            break;
        }
        else if(i == u16PhaseMax)
        {
            u16DLL0Even_Max = i;
        }
        
        cnt1 = cnt0;
    }
    
    cnt0 = 0;
    cnt1 = 0;
    for(i=0;i<=u16PhaseMax;i++)
    {
        if(bDLL0Odd_Result[i] == TRUE)
            cnt0++;
        else
            cnt0 = 0;
    
        if(cnt0 == 3)
            u16DLL0Odd_Min = i-2;
    
        if((cnt1 > 2) && (cnt0 == 0))
        {
            u16DLL0Odd_Max= i-1;
            break;
        }
        else if(i == u16PhaseMax)
        {
            u16DLL0Odd_Max = i;
        }
        
        cnt1 = cnt0;
    }

    cnt0 = 0;
    cnt1 = 0;
    for(i=0;i<=u16PhaseMax;i++)
    {
        if(bDLL1Even_Result[i] == TRUE)
            cnt0++;
        else
            cnt0 = 0;
    
        if(cnt0 == 3)
            u16DLL1Even_Min = i-2;
    
        if((cnt1 > 2) && (cnt0 == 0))
        {
            u16DLL1Even_Max= i-1;
            break;
        }
        else if(i == u16PhaseMax)
        {
            u16DLL1Even_Max = i;
        }
        
        cnt1 = cnt0;
    }
    
    cnt0 = 0;
    cnt1 = 0;
    for(i=0;i<=u16PhaseMax;i++)
    {
        if(bDLL1Odd_Result[i] == TRUE)
            cnt0++;
        else
            cnt0 = 0;
    
        if(cnt0 == 3)
            u16DLL1Odd_Min = i-2;
    
        if((cnt1 > 2) && (cnt0 == 0))
        {
            u16DLL1Odd_Max= i-1;
            break;
        }
        else if(i == u16PhaseMax)
        {
            u16DLL1Odd_Max = i;
        }
        
        cnt1 = cnt0;
    }

    // Customize settings for WB 128Mb
    if((msReadByte(0x12213E)==0x13))
    {
        if((u16DLL0Even_Min+u16DLL0Even_Max)>(u16DLL1Even_Min+u16DLL1Even_Max))
        {
            u16DLL1Even_Min = u16DLL0Even_Min;
            u16DLL1Even_Max = u16DLL0Even_Max;
        }
        else
        {
            u16DLL0Even_Min = u16DLL1Even_Min;
            u16DLL0Even_Max = u16DLL1Even_Max;
        }

        if((u16DLL0Odd_Min+u16DLL0Odd_Max)>(u16DLL1Odd_Min+u16DLL1Odd_Max))
        {
            u16DLL1Odd_Min = u16DLL0Odd_Min;
            u16DLL1Odd_Max = u16DLL0Odd_Max;
        }
        else
        {
            u16DLL0Odd_Min = u16DLL1Odd_Min;
            u16DLL0Odd_Max = u16DLL1Odd_Max;
        }
    }
    
    // Update phase
    u16Kcode /= 2;
    u8DLL0_Even = DIFF(u16Kcode, ((u16DLL0Even_Min+u16DLL0Even_Max)/2))|((MAX(u16Kcode, ((u16DLL0Even_Min+u16DLL0Even_Max)/2))==u16Kcode)?BIT5:0);
    u8DLL0_Odd = DIFF(u16Kcode, ((u16DLL0Odd_Min+u16DLL0Odd_Max)/2))|((MAX(u16Kcode, ((u16DLL0Odd_Min+u16DLL0Odd_Max)/2))==u16Kcode)?BIT5:0);
    u8DLL1_Even = DIFF(u16Kcode, ((u16DLL1Even_Min+u16DLL1Even_Max)/2))|((MAX(u16Kcode, ((u16DLL1Even_Min+u16DLL1Even_Max)/2))==u16Kcode)?BIT5:0);
    u8DLL1_Odd = DIFF(u16Kcode, ((u16DLL1Odd_Min+u16DLL1Odd_Max)/2))|((MAX(u16Kcode, ((u16DLL1Odd_Min+u16DLL1Odd_Max)/2))==u16Kcode)?BIT5:0);

    msWriteByteMask(0x122194, u8DLL0_Even, 0x3F);
    msWriteByteMask(0x122195, u8DLL1_Even, 0x3F);
    msWriteByteMask(0x1221A4, u8DLL0_Odd, 0x3F);
    msWriteByteMask(0x1221A5, u8DLL1_Odd, 0x3F);

    if(msMemoryBist())
    {
        MSFB_printMsg("=====>   Memory Bist PASS After Auto K !!  <======\r\n");
    }
    else
    {
        MSFB_printMsg("=====>   Memory Bist FAIL After Auto K !!  <======\r\n");
    }

#endif
}

#ifdef TSUMR2_FPGA
void msInitMemory( void )
{
    XDATA BYTE i, ucDDRInitCount=0;
    BOOL bDDR3InitState;

    for( i = 0; i < sizeof( tInitMemory ) / sizeof( RegUnitType ); i++ )
        msWriteByte( tInitMemory[i].u16Reg, tInitMemory[i].u8Value );


    bDDR3InitState = FALSE;
    while(ucDDRInitCount++<10)
    {
        if(msMemoryBist())
        {
            bDDR3InitState = TRUE;
            MSFB_printMsg("=====>   Memory Init PASS!!  <======\r\n");
            break;
        }
    }

    if(bDDR3InitState == FALSE)
    {
    #if ENABLE_DEBUG
        MSFB_printMsg("=====>   Memory Init Fail!!  <======\r\n");
        ForceDelay1ms(3000);
        ForceDelay1ms(3000);
        ForceDelay1ms(3000);
    #endif
    }

    msWrite2Byte(0x123086, 0x0000); // MIU UnMask
    msWrite2Byte(0x123306, 0x0000);

    //===================================
    old_msWriteByte( 0x00,tMemTestMode[0]);
    msAutoDQSPhase();
    msMiuProtectCtrl(0,0,0,0,0);
}
#else
//////////////////////////////////////////////////////////////////
// Modulation Freq: 0~30KHz (freqMod -0~30), Range: 0~1% (range -0~10) //
//////////////////////////////////////////////////////////////////
void msSetDDRSSCEnable( Bool bEnable )
{
    MSFB_printData("DDRSSC Enable[%x]",bEnable);

    msWriteByteMask(REG_122129, bEnable?(BIT7|BIT6):BIT7, BIT7|BIT6);
}

void msSetDDRSSCFactor( Bool bEnable, BYTE freqMod, BYTE range )
{
    static DWORD xdata dwFactorBK = 0;
    WORD xdata wStep;
    WORD xdata wSpan;
    DWORD xdata dwMPLL_MHZ = 432UL;
#if ((DRAM_TYPE == DDR2_1333_512Mb_QFP156) || (DRAM_TYPE == DDR2_1333_512Mb_QFP216))
    DWORD xdata dwMCLK_MHZ = 1333UL;
#else
    DWORD xdata dwMCLK_MHZ = 1200UL;
#endif
    DWORD xdata dwFactor = (float)((float)dwMPLL_MHZ*8/1)*((float)524288UL/(dwMCLK_MHZ/2));
    dwFactor += dwFactor*DDR_REDUCE_PERCENTAGE_DEF/1000;

    if( (freqMod == 0) || (range == 0) )
    {
        dwFactorBK = 0;

        wStep = 0;
        wSpan = 0;
    }
    else
    {
        // freqMod: 0~30 means 0~30K
        if(freqMod > DDR_SSC_MODULATION_MAX)
            freqMod = DDR_SSC_MODULATION_MAX;

        // range: 0~10 means 0~1%
        if(range > DDR_SSC_PERCENTAGE_MAX)
            range = DDR_SSC_PERCENTAGE_MAX;

        if( bEnable && (range > DDR_REDUCE_PERCENTAGE_DEF) ) 
        {
            dwFactor = (float)((float)dwMPLL_MHZ*8/1)*((float)524288UL/(dwMCLK_MHZ/2));
            dwFactor += dwFactor*range/1000;
        }

        wSpan = (((float)dwMPLL_MHZ*1000ul/freqMod)*131072ul)/dwFactor;
        wStep = (((float)range*dwFactor+(DWORD)500*wSpan)/((DWORD)1000*wSpan));

        //drvmStar_printData("DDRSSC SPAN[%x]",wSpan);
        //drvmStar_printData("DDRSSC STEP[%x]",wStep);

        if (wStep > 0x3FF)
            wStep = 0x3FF;

        if(wSpan > 0x3FFF)
            wSpan = 0x3FFF;
    }

    if(dwFactorBK != dwFactor)
    {
        msWrite3Byte(REG_122130, dwFactor);
        dwFactorBK = dwFactor;
    }
    
    msWrite2ByteMask(REG_122128, wStep, 0x3FF);
    msWrite2ByteMask(REG_12212A, wSpan, 0x3FFF);
    msWriteByteMask(REG_122129, bEnable?(BIT7|BIT6):BIT7, BIT7|BIT6);
}
#if 0
void msInitMemoryWinbond( void )
{
    XDATA DWORD dwDdrSet;

#if ((DRAM_TYPE == SDR_1Mx16_QFP256) || (DRAM_TYPE == SDR_1Mx16_QFP216) || (DRAM_TYPE == SDR_1Mx16_QFP156))
    dwDdrSet = 0x00228F5C; // 200MHz
#elif((DRAM_TYPE == DDR_8Mx16_QFP256) || (DRAM_TYPE == DDR_8Mx16_QFP216) || (DRAM_TYPE == DDR_8Mx16_QFP156))
    dwDdrSet = 0x001BA5E3; // 500MHz
#endif

    dwDdrSet += ((dwDdrSet*DDR_SSC_DEVIATION)/(1000-DDR_SSC_DEVIATION));
#if ((DRAM_TYPE == SDR_1Mx16_QFP256) || (DRAM_TYPE == SDR_1Mx16_QFP216) || (DRAM_TYPE == SDR_1Mx16_QFP156))
    msWrite2Byte(REG_101220, 0x0000);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C01);
    msWrite2Byte(REG_101202, 0x0000);
    msWrite2Byte(REG_101246, 0xFFFE);
    msWrite2Byte(REG_101266, 0xFFFF);
    msWrite2Byte(REG_101286, 0xFFFF);
    msWrite2Byte(REG_1012A6, 0xFFFF);
    // set DDRPLL0 2000MHz
    msWrite2Byte(REG_101136, 0x4004);
    msWrite2Byte(REG_101134, 0x0000);
    msWrite2Byte(REG_101130, dwDdrSet);
    msWrite2Byte(REG_101132, dwDdrSet>>16);
    msWrite2Byte(REG_101178, 0x0001);
    msWrite2Byte(REG_101122, 0x2000);
    msWrite2Byte(REG_101124, 0x2000);
    msWrite2Byte(REG_101124, 0x3000);
    msWrite2Byte(REG_101124, 0x2000);
    ForceDelay1ms(10); // wait PLL stable
    msWrite2Byte(REG_101202, 0x0000);
    msWrite2Byte(REG_101204, 0x01CB);
    msWrite2Byte(REG_101206, 0x1120);
    msWrite2Byte(REG_101208, 0x0844);
    msWrite2Byte(REG_10120A, 0x1233);
    msWrite2Byte(REG_10120C, 0x7FF1);
    msWrite2Byte(REG_10120E, 0x100E);
    msWrite2Byte(REG_101210, 0x0031);
    msWrite2Byte(REG_10122A, 0x400F);
    msWrite2Byte(REG_101102, 0x0101);
    msWrite2Byte(REG_101138, 0x0004);
    msWrite2Byte(REG_10113A, 0x0040);
    msWrite2Byte(REG_10113C, 0x8000);
    msWrite2Byte(REG_10115C, 0x00FF);
    msWrite2Byte(REG_101174, 0x0000);
    msWrite2Byte(REG_101180, 0x0010);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_101114, 0x00FF);
    msWrite2Byte(REG_101180, 0x0010);
    msWrite2Byte(REG_101108, 0x003F);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_10110E, 0x00C3);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_10121E, 0x0C01);
    msWrite2Byte(REG_10121E, 0x0C00);
    // disable GPIO
    msWrite2Byte(REG_101100, 0x2010);
    msWrite2Byte(REG_101100, 0x0000);
    msWrite2Byte(REG_10117C, 0x0000);
    msWrite2Byte(REG_101100, 0x0001);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_10110E, 0x00C3);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_101200, 0x0000);
    msWrite2Byte(REG_101200, 0x0008);
    msWrite2Byte(REG_101200, 0x000C);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x000E);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x001F);
    ForceDelay1ms(10); // check REG_101200 #15 for wait initial done
    msWrite2Byte(REG_10121E, 0x1A08);
    msWrite2Byte(REG_101240, 0x8015);
    msWrite2Byte(REG_101260, 0x8015);
    msWrite2Byte(REG_101280, 0x8015);
    msWrite2Byte(REG_1012A0, 0x8015);
    msWrite2Byte(REG_101246, 0x0000);
    msWrite2Byte(REG_101266, 0x0000);
    msWrite2Byte(REG_101286, 0x0000);
    msWrite2Byte(REG_1012A6, 0x0000);
    msWrite2Byte(REG_1012FE, 0x80E1);
    msWrite2Byte(REG_1012E0, 0x0000);
    msWrite2Byte(REG_1012F0, 0x0000);
    msWrite2Byte(REG_10122A, 0x4000);
    msWrite2Byte(REG_101252, 0xFFFF);
    msWrite2Byte(REG_101272, 0xFFFF);
    msWrite2Byte(REG_101292, 0xFFFF);
    msWrite2Byte(REG_1012B2, 0xFFFF);
#elif ((DRAM_TYPE == DDR_8Mx16_QFP256) || (DRAM_TYPE == DDR_8Mx16_QFP216) || (DRAM_TYPE == DDR_8Mx16_QFP156))
    msWrite2Byte(REG_101220, 0x0000);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C01);
    //msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_101202, 0x0000);
    msWrite2Byte(REG_101246, 0xFFFE);
    msWrite2Byte(REG_101266, 0xFFFF);
    msWrite2Byte(REG_101286, 0xFFFF);
    msWrite2Byte(REG_1012A6, 0xFFFF);
    // set DDRPLL0 2000MHz
    msWrite2Byte(REG_101136, 0x4000);
    msWrite2Byte(REG_101134, 0x0000);
    msWrite2Byte(REG_101130, dwDdrSet);
    msWrite2Byte(REG_101132, dwDdrSet>>16);
    msWrite2Byte(REG_101178, 0x0001);
    msWrite2Byte(REG_101122, 0x2000);
    msWrite2Byte(REG_101124, 0x2000);
    msWrite2Byte(REG_101124, 0x3000);
    msWrite2Byte(REG_101124, 0x2000);
    ForceDelay1ms(10); // wait PLL stable
    // set DDR_16_2X_CL2_500
    msWrite2Byte(REG_101202, 0x0151);
    msWrite2Byte(REG_101204, 0x004B);
    msWrite2Byte(REG_101206, 0x1420);
    msWrite2Byte(REG_101208, 0x2266);
    msWrite2Byte(REG_10120A, 0x0C53);
    msWrite2Byte(REG_10120C, 0x5231);
    msWrite2Byte(REG_10120E, 0x1020);
    msWrite2Byte(REG_101210, 0x0031);
    msWrite2Byte(REG_101212, 0x4000);
    msWrite2Byte(REG_101214, 0x8000);
    msWrite2Byte(REG_101216, 0xC000);
    msWrite2Byte(REG_101102, 0xAAAA);
    msWrite2Byte(REG_101104, 0x0000);
    msWrite2Byte(REG_10113C, 0x0000);
    msWrite2Byte(REG_10113E, 0x0000);
#if (DRAM_TYPE == DDR_8Mx16_QFP156)
    msWrite2Byte(REG_10113A, 0x0053);
#else // (DRAM_TYPE == DDR_8Mx16_QFP256) || (DRAM_TYPE == DDR_8Mx16_QFP216)
    msWrite2Byte(REG_10113A, 0x0043);
#endif
    msWrite2Byte(REG_101148, 0x0000);
    msWrite2Byte(REG_10114C, 0x0000);
    msWrite2Byte(REG_10114E, 0x0000);
    msWrite2Byte(REG_10110A, 0x0000);
    msWrite2Byte(REG_101150, 0x0000);
#if (DRAM_TYPE == DDR_8Mx16_QFP256)
    msWrite2Byte(REG_101138, 0x0005);
#else // (DRAM_TYPE == DDR_8Mx16_QFP216) || (DRAM_TYPE == DDR_8Mx16_QFP156)
    msWrite2Byte(REG_101138, 0x0004);
#endif
    msWrite2Byte(REG_10114A, 0x0002);
    msWrite2Byte(REG_101152, 0x0000);
    msWrite2Byte(REG_10116C, 0x5555);
    msWrite2Byte(REG_10116E, 0x5555);
#if (DRAM_TYPE == DDR_8Mx16_QFP256)
    msWrite2Byte(REG_101174, 0x0033);
#else // (DRAM_TYPE == DDR_8Mx16_QFP216) || (DRAM_TYPE == DDR_8Mx16_QFP156)
    msWrite2Byte(REG_101174, 0x00FF);
#endif
    msWrite2Byte(REG_101184, 0x0000);
    //msWrite2Byte(REG_10110E, 0x00E5);
    //msWrite2Byte(REG_10110E, 0x00A9);
    //msWrite2Byte(REG_10121E, 0x0C01);
    //msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10117E, 0x0000);
    msWrite2Byte(REG_101154, 0xC000);
#if (DRAM_TYPE == DDR_8Mx16_QFP256)
    msWrite2Byte(REG_101114, 0x00AA);
    msWrite2Byte(REG_10115C, 0x00BB);
#else // (DRAM_TYPE == DDR_8Mx16_QFP216) || (DRAM_TYPE == DDR_8Mx16_QFP156)
    msWrite2Byte(REG_101114, 0x00FF);
    msWrite2Byte(REG_10115C, 0x00FF);
#endif
    msWrite2Byte(REG_101180, 0x0001);
    msWrite2Byte(REG_101182, 0x0000);
    msWrite2Byte(REG_101184, 0x0000);
    msWrite2Byte(REG_101108, 0x003F);
    msWrite2Byte(REG_10110E, 0x00A9);
    msWrite2Byte(REG_10110E, 0x00E9);
    msWrite2Byte(REG_10110E, 0x00A9);
    //msWrite2Byte(REG_10121E, 0x0C01);
    msWrite2Byte(REG_10121E, 0x0C00);
    // disable GPIO
    msWrite2Byte(REG_101100, 0x2010);
    msWrite2Byte(REG_101100, 0x0000);
    msWrite2Byte(REG_10117C, 0x0000);
    msWrite2Byte(REG_101100, 0x0000);
    msWrite2Byte(REG_10110E, 0x00A9);
    msWrite2Byte(REG_10110E, 0x00E9);
    msWrite2Byte(REG_10110E, 0x00A9);
    msWrite2Byte(REG_101200, 0x0000);
    msWrite2Byte(REG_101200, 0x0008);
    msWrite2Byte(REG_101200, 0x000C);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x000E);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x001F);
    ForceDelay1ms(10); // check REG_101200 #15 for wait initial done
    msWrite2Byte(REG_10121E, 0x1A08);
    msWrite2Byte(REG_101240, 0x8015);
    msWrite2Byte(REG_101260, 0x8015);
    msWrite2Byte(REG_101280, 0x8015);
    msWrite2Byte(REG_1012A0, 0x8015);
    msWrite2Byte(REG_101246, 0x0000);
    msWrite2Byte(REG_101266, 0x0000);
    msWrite2Byte(REG_101286, 0x0000);
    msWrite2Byte(REG_1012A6, 0x0000);
    msWrite2Byte(REG_1012FE, 0x80E1);
    msWrite2Byte(REG_1012E0, 0x0000);
    msWrite2Byte(REG_1012F0, 0x0000);
    msWrite2Byte(REG_10122A, 0x4000);
    msWrite2Byte(REG_101252, 0xFFFF);
    msWrite2Byte(REG_101272, 0xFFFF);
    msWrite2Byte(REG_101292, 0xFFFF);
    msWrite2Byte(REG_1012B2, 0xFFFF);
#endif
}

void msInitMemoryESMT( void )
{
    XDATA DWORD dwDdrSet;

#if ((DRAM_TYPE == SDR_1Mx16_QFP256) || (DRAM_TYPE == SDR_1Mx16_QFP216) || (DRAM_TYPE == SDR_1Mx16_QFP156))
    dwDdrSet = 0x00228F5C; // 200MHz
#else//((DRAM_TYPE == DDR_8Mx16_QFP256) || (DRAM_TYPE == DDR_8Mx16_QFP216) || (DRAM_TYPE == DDR_8Mx16_QFP156))
    dwDdrSet = 0x001BA5E3; // 500MHz
#endif

    dwDdrSet += ((dwDdrSet*DDR_SSC_DEVIATION)/(1000-DDR_SSC_DEVIATION));
#if ((DRAM_TYPE == SDR_1Mx16_QFP256) || (DRAM_TYPE == SDR_1Mx16_QFP216) || (DRAM_TYPE == SDR_1Mx16_QFP156))
    msWrite2Byte(REG_101220, 0x0000);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C01);
    msWrite2Byte(REG_101202, 0x0000);
    msWrite2Byte(REG_101246, 0xFFFE);
    msWrite2Byte(REG_101266, 0xFFFF);
    msWrite2Byte(REG_101286, 0xFFFF);
    msWrite2Byte(REG_1012A6, 0xFFFF);
    // set DDRPLL0 2000MHz
    msWrite2Byte(REG_101136, 0x4004);
    msWrite2Byte(REG_101134, 0x0000);
    msWrite2Byte(REG_101130, dwDdrSet);
    msWrite2Byte(REG_101132, dwDdrSet>>16);
    msWrite2Byte(REG_101178, 0x0001);
    msWrite2Byte(REG_101122, 0x2000);
    msWrite2Byte(REG_101124, 0x2000);
    msWrite2Byte(REG_101124, 0x3000);
    msWrite2Byte(REG_101124, 0x2000);
    ForceDelay1ms(10); // wait PLL stable
    msWrite2Byte(REG_101202, 0x0000);
    msWrite2Byte(REG_101204, 0x01CB);
    msWrite2Byte(REG_101206, 0x1120);
    msWrite2Byte(REG_101208, 0x0844);
    msWrite2Byte(REG_10120A, 0x1233);
    msWrite2Byte(REG_10120C, 0x7FF1);
    msWrite2Byte(REG_10120E, 0x100E);
    msWrite2Byte(REG_101210, 0x0031);
    msWrite2Byte(REG_10122A, 0x400F);
    msWrite2Byte(REG_101102, 0x0101);
#if (DRAM_TYPE == SDR_1Mx16_QFP256)
    msWrite2Byte(REG_101138, 0x0005);
#else // (DRAM_TYPE == SDR_1Mx16_QFP256) || (DRAM_TYPE == SDR_1Mx16_QFP156)
    msWrite2Byte(REG_101138, 0x0004);
#endif
    msWrite2Byte(REG_10113A, 0x0030);
    msWrite2Byte(REG_10113C, 0x8000);
    msWrite2Byte(REG_10115C, 0x00FF);
    msWrite2Byte(REG_101174, 0x0000);
    msWrite2Byte(REG_101180, 0x0010);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_101114, 0x00FF);
    msWrite2Byte(REG_101180, 0x0010);
    msWrite2Byte(REG_101108, 0x003F);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_10110E, 0x00C3);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_10121E, 0x0C01);
    msWrite2Byte(REG_10121E, 0x0C00);
    // disable GPIO
    msWrite2Byte(REG_101100, 0x2010);
    msWrite2Byte(REG_101100, 0x0000);
    msWrite2Byte(REG_10117C, 0x0000);
    msWrite2Byte(REG_101100, 0x0001);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_10110E, 0x00C3);
    msWrite2Byte(REG_10110E, 0x0083);
    msWrite2Byte(REG_101200, 0x0000);
    msWrite2Byte(REG_101200, 0x0008);
    msWrite2Byte(REG_101200, 0x000C);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x000E);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x001F);
    ForceDelay1ms(10); // check REG_101200 #15 for wait initial done
    msWrite2Byte(REG_10121E, 0x1A08);
    msWrite2Byte(REG_101240, 0x8015);
    msWrite2Byte(REG_101260, 0x8015);
    msWrite2Byte(REG_101280, 0x8015);
    msWrite2Byte(REG_1012A0, 0x8015);
    msWrite2Byte(REG_101246, 0x0000);
    msWrite2Byte(REG_101266, 0x0000);
    msWrite2Byte(REG_101286, 0x0000);
    msWrite2Byte(REG_1012A6, 0x0000);
    msWrite2Byte(REG_1012FE, 0x80E1);
    msWrite2Byte(REG_1012E0, 0x0000);
    msWrite2Byte(REG_1012F0, 0x0000);
    msWrite2Byte(REG_10122A, 0x4000);
    msWrite2Byte(REG_101252, 0xFFFF);
    msWrite2Byte(REG_101272, 0xFFFF);
    msWrite2Byte(REG_101292, 0xFFFF);
    msWrite2Byte(REG_1012B2, 0xFFFF);
#elif ((DRAM_TYPE == DDR_8Mx16_QFP256) || (DRAM_TYPE == DDR_8Mx16_QFP216) || (DRAM_TYPE == DDR_8Mx16_QFP156))
    msWrite2Byte(REG_101220, 0x0000);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10121E, 0x0C01);
    //msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_101202, 0x0000);
    msWrite2Byte(REG_101246, 0xFFFE);
    msWrite2Byte(REG_101266, 0xFFFF);
    msWrite2Byte(REG_101286, 0xFFFF);
    msWrite2Byte(REG_1012A6, 0xFFFF);
    // set DDRPLL0 2000MHz
    msWrite2Byte(REG_101136, 0x4000);
    msWrite2Byte(REG_101134, 0x0000);
    msWrite2Byte(REG_101130, dwDdrSet);
    msWrite2Byte(REG_101132, dwDdrSet>>16);
    msWrite2Byte(REG_101178, 0x0001);
    msWrite2Byte(REG_101122, 0x2000);
    msWrite2Byte(REG_101124, 0x2000);
    msWrite2Byte(REG_101124, 0x3000);
    msWrite2Byte(REG_101124, 0x2000);
    ForceDelay1ms(10); // wait PLL stable
    // set DDR_16_2X_CL2_500
    msWrite2Byte(REG_101202, 0x0151);
    msWrite2Byte(REG_101204, 0x004B);
    msWrite2Byte(REG_101206, 0x1420);
    msWrite2Byte(REG_101208, 0x2266);
    msWrite2Byte(REG_10120A, 0x0C53);
    msWrite2Byte(REG_10120C, 0x5231);
    msWrite2Byte(REG_10120E, 0x1020);
    msWrite2Byte(REG_101210, 0x0031);
    msWrite2Byte(REG_101212, 0x4000);
    msWrite2Byte(REG_101214, 0x8000);
    msWrite2Byte(REG_101216, 0xC000);
    msWrite2Byte(REG_101102, 0xAAAA);
    msWrite2Byte(REG_101104, 0x0000);
    msWrite2Byte(REG_10113C, 0x0000);
    msWrite2Byte(REG_10113E, 0x0000);
    msWrite2Byte(REG_10113A, 0x0042);
    msWrite2Byte(REG_101148, 0x0000);
    msWrite2Byte(REG_10114C, 0x0000);
    msWrite2Byte(REG_10114E, 0x0000);
    msWrite2Byte(REG_10110A, 0x0000);
    msWrite2Byte(REG_101150, 0x0000);
    msWrite2Byte(REG_101138, 0x0005);
    msWrite2Byte(REG_10114A, 0x0002);
    msWrite2Byte(REG_101152, 0x0000);
    msWrite2Byte(REG_10116C, 0x5555);
    msWrite2Byte(REG_10116E, 0x5555);
    msWrite2Byte(REG_101174, 0x0033);
    msWrite2Byte(REG_101184, 0x0000);
    //msWrite2Byte(REG_10110E, 0x00E5);
    //msWrite2Byte(REG_10110E, 0x00A9);
    //msWrite2Byte(REG_10121E, 0x0C01);
    //msWrite2Byte(REG_10121E, 0x0C00);
    msWrite2Byte(REG_10117E, 0x0000);
    msWrite2Byte(REG_101154, 0xC000);
    msWrite2Byte(REG_101114, 0x00AA);
    msWrite2Byte(REG_10115C, 0x00BB);
    msWrite2Byte(REG_101180, 0x0001);
    msWrite2Byte(REG_101182, 0x0000);
    msWrite2Byte(REG_101184, 0x0000);
    msWrite2Byte(REG_101108, 0x003F);
    msWrite2Byte(REG_10110E, 0x00A9);
    msWrite2Byte(REG_10110E, 0x00E9);
    msWrite2Byte(REG_10110E, 0x00A9);
    //msWrite2Byte(REG_10121E, 0x0C01);
    msWrite2Byte(REG_10121E, 0x0C00);
    // disable GPIO
    msWrite2Byte(REG_101100, 0x2010);
    msWrite2Byte(REG_101100, 0x0000);
    msWrite2Byte(REG_10117C, 0x0000);
    msWrite2Byte(REG_101100, 0x0000);
    msWrite2Byte(REG_10110E, 0x00A9);
    msWrite2Byte(REG_10110E, 0x00E9);
    msWrite2Byte(REG_10110E, 0x00A9);
    msWrite2Byte(REG_101200, 0x0000);
    msWrite2Byte(REG_101200, 0x0008);
    msWrite2Byte(REG_101200, 0x000C);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x000E);
    ForceDelay1ms(1);
    msWrite2Byte(REG_101200, 0x001F);
    ForceDelay1ms(10); // check REG_101200 #15 for wait initial done
    msWrite2Byte(REG_10121E, 0x1A08);
    msWrite2Byte(REG_101240, 0x8015);
    msWrite2Byte(REG_101260, 0x8015);
    msWrite2Byte(REG_101280, 0x8015);
    msWrite2Byte(REG_1012A0, 0x8015);
    msWrite2Byte(REG_101246, 0x0000);
    msWrite2Byte(REG_101266, 0x0000);
    msWrite2Byte(REG_101286, 0x0000);
    msWrite2Byte(REG_1012A6, 0x0000);
    msWrite2Byte(REG_1012FE, 0x80E1);
    msWrite2Byte(REG_1012E0, 0x0000);
    msWrite2Byte(REG_1012F0, 0x0000);
    msWrite2Byte(REG_10122A, 0x4000);
    msWrite2Byte(REG_101252, 0xFFFF);
    msWrite2Byte(REG_101272, 0xFFFF);
    msWrite2Byte(REG_101292, 0xFFFF);
    msWrite2Byte(REG_1012B2, 0xFFFF);
#endif
}
#endif // #if 0

BYTE msGetMemoryBrand( void )
{
    BYTE u8DRAM_Brand = (msReadByte(REG_CHIPTOP_7D_L) & 0x03);

    if(u8DRAM_Brand == 0x03) //WinBond
    {
        return DDR2_WB;
    }
    else if(u8DRAM_Brand == 0x02) //ESMT
    {
        return DDR2_ESMT;
    }
    else
    {
        MSFB_printMsg("=====>   Unknown Memory Brand  <======\r\n");
        return DRAM_UNKNOWN;
    }
}

BYTE msGetMemorySize( void )
{
    BYTE u8DRAM_Size = 0;

#if ((DRAM_TYPE == DDR2_QFP156) || (DRAM_TYPE == DDR2_QFP216))
    u8DRAM_Size = ((msEread_GetDataFromEfuse(0x181)&BIT7)?DDR2_512Mb:DDR2_128Mb); // 0x181[7] 0: KGD 128Mb, 1: KGD 512Mb
#elif ((DRAM_TYPE == DDR2_1333_512Mb_QFP216) || (DRAM_TYPE == DDR2_1333_512Mb_QFP156))
    u8DRAM_Size = DDR2_512Mb;
#else // ((DRAM_TYPE == DDR2_1200_128Mb_QFP216) || (DRAM_TYPE == DDR2_1200_128Mb_QFP156))
    u8DRAM_Size = DDR2_128Mb;
#endif

    return u8DRAM_Size;
}

DWORD msGetDRAMSize(void)
{
    #ifdef TSUMR2_FPGA
    return 0x10000000UL;
    #else
    switch(msGetMemorySize())
    {
        case DDR2_512Mb:
            return 0x4000000UL;
        break;
        case DDR2_128Mb:
        default:
            return 0x1000000UL;
        break;
    }
    #endif
}

void msMiuBandwidthLimit(void)
{
    //limit R2 DRAM bandwidth 
    msWriteByteMask(0x12201f,0x80,0x80); //DIG_BANK  0x0f [15], reg_no_rq_ctrl_en = 1
    msWrite2Byte(0x123094, 0x4007); // 0x12304A[15:8] = 0x40, 0x12304A [3:0] = 0x07
    msWrite2Byte(0x123096, 0x4089); // 0x12304B[15:8] = 0x40, 0x12304B [7:4] = 0x08, 0x12304B [3:0] = 0x09
    msWriteByteMask(0x123081,0x03,0x03); // 0x122F40[9, 8]=2'b11
}

void msInitMemory( void )
{
    XDATA BYTE ucDDRInitCount=0;
    XDATA WORD i;
    BOOL bDDR3InitState;
    BYTE u8DRAM_Brand = msGetMemoryBrand();
    BYTE u8DRAM_Size = msGetMemorySize();

    if(u8DRAM_Brand == DDR2_WB)
    {
        if(u8DRAM_Size == DDR2_512Mb)
        {
#if ((DRAM_TYPE == DDR2_1333_512Mb_QFP216) || (DRAM_TYPE == DDR2_QFP216))
            MSFB_printMsg("=====>   WinBond_512Mb_QFP216   <======\r\n");
            for( i = 0; i < sizeof( tInitMemory_WB_DDR2_1333_512Mb_QFP216 ) / sizeof( RegUnitType ); i++ )
                msWriteByte( tInitMemory_WB_DDR2_1333_512Mb_QFP216[i].u16Reg, tInitMemory_WB_DDR2_1333_512Mb_QFP216[i].u8Value );
#elif ((DRAM_TYPE == DDR2_1333_512Mb_QFP156) || (DRAM_TYPE == DDR2_QFP156))
            MSFB_printMsg("=====>   WinBond_512Mb_QFP156   <======\r\n");
            for( i = 0; i < sizeof( tInitMemory_WB_DDR2_1333_512Mb_QFP156) / sizeof( RegUnitType ); i++ )
                msWriteByte( tInitMemory_WB_DDR2_1333_512Mb_QFP156[i].u16Reg, tInitMemory_WB_DDR2_1333_512Mb_QFP156[i].u8Value );
#else
            MSFB_printMsg("=====>   Unknown DRAM Type  <======\r\n");
#endif
        }
        else
        {
#if ((DRAM_TYPE == DDR2_1200_128Mb_QFP216) || (DRAM_TYPE == DDR2_QFP216))
            MSFB_printMsg("=====>   WinBond_128Mb_QFP216   <======\r\n");
            for( i = 0; i < sizeof( tInitMemory_WB_DDR2_1200_128Mb_QFP216 ) / sizeof( RegUnitType ); i++ )
                msWriteByte( tInitMemory_WB_DDR2_1200_128Mb_QFP216[i].u16Reg, tInitMemory_WB_DDR2_1200_128Mb_QFP216[i].u8Value );
#elif ((DRAM_TYPE == DDR2_1200_128Mb_QFP156) || (DRAM_TYPE == DDR2_QFP156))
            MSFB_printMsg("=====>   WinBond_128Mb_QFP156   <======\r\n");
            for( i = 0; i < sizeof( tInitMemory_WB_DDR2_1200_128Mb_QFP156) / sizeof( RegUnitType ); i++ )
                msWriteByte( tInitMemory_WB_DDR2_1200_128Mb_QFP156[i].u16Reg, tInitMemory_WB_DDR2_1200_128Mb_QFP156[i].u8Value );
#else
            MSFB_printMsg("=====>   Unknown DRAM Type  <======\r\n");
#endif
        }     
    }
    else if(u8DRAM_Brand == DDR2_ESMT)
    {
        if(u8DRAM_Size == DDR2_512Mb)
        {
            MSFB_printMsg("=====>   ESMT_512Mb   <======\r\n");
            for( i = 0; i < sizeof( tInitMemory_ESMT_DDR2_1333_512Mb ) / sizeof( RegUnitType ); i++ )
                msWriteByte( tInitMemory_ESMT_DDR2_1333_512Mb[i].u16Reg, tInitMemory_ESMT_DDR2_1333_512Mb[i].u8Value );
        }
        else
        {
            MSFB_printMsg("=====>   ESMT_128Mb   <======\r\n");
            for( i = 0; i < sizeof( tInitMemory_ESMT_DDR2_1200_128Mb ) / sizeof( RegUnitType ); i++ )
                msWriteByte( tInitMemory_ESMT_DDR2_1200_128Mb[i].u16Reg, tInitMemory_ESMT_DDR2_1200_128Mb[i].u8Value );
        }
    }
    else
    {
        MSFB_printMsg("=====>   Unknown DRAM Type  <======\r\n");
    }

    msWriteByteMask(REG_120F06, 0x00, 0x0C); // set miu clk to 216 TBD!!


    bDDR3InitState = FALSE;
    while(ucDDRInitCount++<10)
    {
        if(msMemoryBist())
        {
            bDDR3InitState = TRUE;
            MSFB_printMsg("=====>   Memory Init PASS!!  <======\r\n");
            break;
        }
    }

    if(bDDR3InitState == FALSE)
    {
#if ENABLE_DEBUG
        MSFB_printMsg("=====>   Memory Init Fail!!  <======\r\n");
        ForceDelay1ms(3000);
        ForceDelay1ms(3000);
        ForceDelay1ms(3000);
#endif
    }

    msWrite2Byte(0x123086, 0x0000); // MIU UnMask
    msWrite2Byte(0x123306, 0x0000);

    msSetDDRSSCFactor(ENABLE_DDR_SSC, DDR_SSC_MODULATION_DEF, DDR_SSC_PERCENTAGE_DEF);

    //===================================
    old_msWriteByte( 0x00,tMemTestMode[0]);
    msAutoDQSPhase();
    msMiuProtectCtrl(0,0,0,0,0);
    msMiuBandwidthLimit();
}
#endif

void msMiuProtectCtrl(BYTE ucGroup, BOOL bCtrl, WORD ucID, DWORD wAddrStart, DWORD wAddrEnd)
{
#if 0
    xdata BYTE ucIDNum ,i,j;
    xdata DWORD ucProtectID;

    ucIDNum =(ucGroup == MIU_PROTECT_0) ? 4:2;
    ucProtectID = 0;
    j = 0;

    for(i=0;i<16;i++)
    {
        if(ucID&(1<<i))
        {
            ucProtectID |=((DWORD)i<<(j*8));
            j++;
        }
        if(j==ucIDNum)
            break;
    }

    switch(ucGroup)
    {
        case MIU_PROTECT_0:
            old_msWrite2Byte(REG_12C2,ucProtectID);
            old_msWrite2Byte(REG_12C4,ucProtectID>>16);
            old_msWrite2Byte(REG_12C6,wAddrStart/0x800);
            old_msWrite2Byte(REG_12C8,wAddrEnd/0x800-1);
            old_msWriteBit(REG_12C0,bCtrl,MIU_PROTECT_0);
            break;
        case MIU_PROTECT_1:
            old_msWrite2Byte(REG_12CA,ucProtectID);
            old_msWrite2Byte(REG_12CC,wAddrStart/0x800);
            old_msWrite2Byte(REG_12CE,wAddrEnd/0x800-1);
            old_msWriteBit(REG_12C0,bCtrl,MIU_PROTECT_1);
            break;
        case MIU_PROTECT_2:
            old_msWrite2Byte(REG_12D0,ucProtectID);
            old_msWrite2Byte(REG_12D2,wAddrStart/0x800);
            old_msWrite2Byte(REG_12D4,wAddrEnd/0x800-1);
            old_msWriteBit(REG_12C0,bCtrl,MIU_PROTECT_2);
            break;
        case MIU_PROTECT_3:
            old_msWrite2Byte(REG_12D6,ucProtectID);
            old_msWrite2Byte(REG_12D8,wAddrStart/0x800);
            old_msWrite2Byte(REG_12DA,wAddrEnd/0x800-1);
            old_msWriteBit(REG_12C0,bCtrl,MIU_PROTECT_3);
            break;
    }

#else

	ucGroup = ucGroup;
	bCtrl = bCtrl;
	ucID = ucID;
	wAddrStart = wAddrStart;
	wAddrEnd = wAddrEnd;
    MSFB_printMsg("msMiuProtectCtrl() TBD!");

#endif
}

#endif

